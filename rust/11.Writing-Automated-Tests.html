<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html -->

<!----><title>Yes! I Take IT :)</title>
<meta name="description" content="In his 1972 essay “The Humble Programmer,” Edsger W. Dijkstra said that “Program testing can be a very effective way to show the presence of bugs, but it is hopelessly inadequate for showing their absence.” That doesn’t mean we shouldn’t try to test as much as we can!">


  <meta name="author" content="JJungs-lee">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Yes! I Take IT">
<meta property="og:title" content="RUST : 11. Writing Automated Tests">
<meta property="og:url" content="https://jjungs-lee.github.io//rust/11.Writing-Automated-Tests">


  <meta property="og:description" content="In his 1972 essay “The Humble Programmer,” Edsger W. Dijkstra said that “Program testing can be a very effective way to show the presence of bugs, but it is hopelessly inadequate for showing their absence.” That doesn’t mean we shouldn’t try to test as much as we can!">







  <meta property="article:published_time" content="2020-03-09T00:00:00+00:00">





  

  


<link rel="canonical" href="https://jjungs-lee.github.io//rust/11.Writing-Automated-Tests">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "JJungs-lee",
      "url": "https://jjungs-lee.github.io//"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="NONE" type="application/atom+xml" rel="alternate" title="Yes! I Take IT Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          <b>I.T.I</b> <small>by JHLee</small>
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/kernel/" >Kernel</a>
            </li><li class="masthead__menu-item">
              <a href="/swim/" >Swim</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/author_jhl.png" alt="JJungs-lee" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">JJungs-lee</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Do Coding! Do Study!</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="RUST : 11. Writing Automated Tests">
    <meta itemprop="description" content="In his 1972 essay “The Humble Programmer,” Edsger W. Dijkstra said that “Program testing can be a very effective way to show the presence of bugs, but it is hopelessly inadequate for showing their absence.” That doesn’t mean we shouldn’t try to test as much as we can!">
    <meta itemprop="datePublished" content="2020-03-09T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">RUST : 11. Writing Automated Tests
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  40 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In his 1972 essay “The Humble Programmer,” Edsger W. Dijkstra said that “Program testing can be a very effective way to show the presence of bugs, 
but it is hopelessly inadequate for showing their absence.” That doesn’t mean we shouldn’t try to test as much as we can!</p>

<p>Correctness in our programs is the extent to which our code does what we intend it to do. 
Rust is designed with a high degree of concern about the correctness of programs, but correctness is complex and not easy to prove. 
Rust’s type system shoulders a huge part of this burden, but the type system cannot catch every kind of incorrectness. 
As such, <strong>Rust includes support for writing automated software tests within the language</strong>.</p>

<p>As an example, say we write a function called <code class="language-plaintext highlighter-rouge">add_two</code> that adds <code class="language-plaintext highlighter-rouge">2</code> to whatever number is passed to it. 
This function’s signature accepts an integer as a parameter and returns an integer as a result. 
When we implement and compile that function, Rust does all the type checking and borrow checking that you’ve learned so far to ensure that, 
for instance, we aren’t passing a <code class="language-plaintext highlighter-rouge">String</code> value or an invalid reference to this function. 
But Rust <strong>can’t check</strong> that this function will do precisely what we intend, which is return the parameter plus 2 rather than, say, the parameter plus 10 or the parameter minus 50! That’s where tests come in.</p>

<p>We can write tests that assert, for example, that when we pass <code class="language-plaintext highlighter-rouge">3</code> to the <code class="language-plaintext highlighter-rouge">add_two</code> function, the returned value is <code class="language-plaintext highlighter-rouge">5</code>. 
We can run these tests whenever we make changes to our code to make sure any existing correct behavior has not changed.</p>

<p><strong>Testing is a complex skill</strong>: although we can’t cover every detail about how to write good tests in one chapter, we’ll discuss the mechanics of Rust’s testing facilities. We’ll talk about the annotations and macros available to you when writing your tests, the default behavior and options provided for running your tests, and how to organize tests into unit tests and integration tests.</p>

<h2 id="how-to-write-tests">How to Write Tests</h2>
<p>Tests are Rust functions that verify that the non-test code is functioning in the expected manner. 
The bodies of test functions typically perform these three actions:</p>

<ol>
  <li>Set up any needed data or state.</li>
  <li>Run the code you want to test.</li>
  <li>Assert the results are what you expect.
Let’s look at the features Rust provides specifically for writing tests that take these actions, which include the <code class="language-plaintext highlighter-rouge">test</code> attribute, a few macros, and the <code class="language-plaintext highlighter-rouge">should_panic</code> attribute.</li>
</ol>

<h3 id="the-anatomy-of-a-test-function">The Anatomy of a Test Function</h3>
<p>At its simplest, a test in Rust is a function that’s <strong>annotated</strong> with the <code class="language-plaintext highlighter-rouge">test</code> attribute. 
Attributes are metadata about pieces of Rust code; one example is the <code class="language-plaintext highlighter-rouge">derive</code> attribute we used with structs in Chapter 5. 
To change a function into a test function, add <code class="language-plaintext highlighter-rouge">#[test]</code> on the line before <code class="language-plaintext highlighter-rouge">fn</code>. 
When you run your tests with the <code class="language-plaintext highlighter-rouge">cargo test</code> command, Rust builds a test runner binary that runs the functions annotated with the <code class="language-plaintext highlighter-rouge">test</code> attribute and reports on whether each test function passes or fails.</p>

<p>When we make a new library project with Cargo, a test module with a test function in it is <strong>automatically</strong> generated for us. 
This module helps you start writing your tests so you don’t have to look up the exact structure and syntax of test functions every time you start a new project. 
You can add as many additional test functions and as many test modules as you want!</p>

<p>We’ll explore some aspects of how tests work by experimenting with the template test generated for us without actually testing any code. 
Then we’ll write some real-world tests that call some code that we’ve written and assert that its behavior is correct.</p>

<p>Let’s create a new library project called <code class="language-plaintext highlighter-rouge">adder</code>:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">new</span> <span class="n">adder</span> <span class="o">--</span><span class="n">lib</span>
     <span class="n">Created</span> <span class="n">library</span> <span class="err">`</span><span class="n">adder</span><span class="err">`</span> <span class="n">project</span>
<span class="err">$</span> <span class="n">cd</span> <span class="n">adder</span>
</code></pre></div></div>
<p>The contents of the <code class="language-plaintext highlighter-rouge">src/lib.rs</code> file in your adder library should look like Listing 11-1.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Filename: src/lib.rs</span>
<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">it_works</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-1-the-test-module-and-function-generated-automatically-by-cargo-new">Listing 11-1: The test module and function generated automatically by cargo new</h4>

<p>For now, let’s ignore the top two lines and focus on the function to see how it works. 
Note the <code class="language-plaintext highlighter-rouge">#[test]</code> annotation before the <code class="language-plaintext highlighter-rouge">fn</code> line: this attribute indicates this is a <strong>test function</strong>, so the test runner knows to treat this function as a test. 
We could also have non-test functions in the tests module to help set up common scenarios or perform common operations, so we need to indicate which functions are tests by using the <code class="language-plaintext highlighter-rouge">#[test]</code> attribute.</p>

<p>The function body uses the <code class="language-plaintext highlighter-rouge">assert_eq!</code> macro to assert that 2 + 2 equals 4. 
This assertion serves as an example of the format for a typical test. Let’s run it to see that this test passes.</p>

<p>The <code class="language-plaintext highlighter-rouge">cargo test</code> command runs all tests in our project, as shown in Listing 11-2.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span>
   <span class="n">Compiling</span> <span class="n">adder</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="c">///projects/adder)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.22</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="n">ce99bcc2479f4607</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">it_works</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

   <span class="n">Doc</span><span class="o">-</span><span class="n">tests</span> <span class="n">adder</span>

<span class="n">running</span> <span class="mi">0</span> <span class="n">tests</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<h4 id="listing-11-2-the-output-from-running-the-automatically-generated-test">Listing 11-2: The output from running the automatically generated test</h4>

<p>Cargo compiled and ran the test. 
After the <strong>Compiling</strong>, <strong>Finished</strong>, and <strong>Running</strong> lines is the line <strong>running 1 test</strong>. 
The next line shows the name of the generated test function, called <code class="language-plaintext highlighter-rouge">it_works</code>, and the result of running that test, ok. 
The overall summary of running the tests appears next. 
The text test <code class="language-plaintext highlighter-rouge">result: ok</code>. means that all the tests passed, and the portion that reads <code class="language-plaintext highlighter-rouge">1 passed; 0 failed</code> totals the number of tests that passed or failed.</p>

<p>Because we don’t have any tests we’ve marked as ignored, the summary shows <code class="language-plaintext highlighter-rouge">0 ignored</code>. 
We also haven’t filtered the tests being run, so the end of the summary shows 0 filtered out. 
We’ll talk about ignoring and filtering out tests in the next section, <a href="#controlling-how-tests-are-run">“Controlling How Tests Are Run.”</a></p>

<p>The next part of the test output, which starts with <code class="language-plaintext highlighter-rouge">Doc-tests adder</code>, is for the results of any documentation tests. 
We don’t have any documentation tests yet, but Rust can compile any code examples that appear in our API documentation. 
This feature helps us keep our docs and our code in sync! We’ll discuss how to write documentation tests in the <a href="#documentation-comments-as-tests">“Documentation Comments as Tests”</a> section of Chapter 14. 
For now, we’ll ignore the <code class="language-plaintext highlighter-rouge">Doc-tests</code> output.</p>

<p>Let’s change the name of our test to see how that changes the test output. 
Change the <code class="language-plaintext highlighter-rouge">it_works</code> function to a different name, such as exploration, like so:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">exploration</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Then run <code class="language-plaintext highlighter-rouge">cargo test</code> again. The output now shows <code class="language-plaintext highlighter-rouge">exploration</code> instead of <code class="language-plaintext highlighter-rouge">it_works</code>:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">exploration</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>Let’s add another test, but this time we’ll make a test that fails! 
Tests fail when something in the test function <strong>panics</strong>. 
Each test is run in a new thread, and when the main thread sees that a test thread has died, the test is marked as failed. 
We talked about the simplest way to cause a panic in Chapter 9, which is to call the <code class="language-plaintext highlighter-rouge">panic!</code> macro. 
Enter the new test, another, so your <code class="language-plaintext highlighter-rouge">src/lib.rs</code> file looks like Listing 11-3.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">exploration</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">another</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">panic!</span><span class="p">(</span><span class="s">"Make this test fail"</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-3-adding-a-second-test-that-will-fail-because-we-call-the-panic-macro">Listing 11-3: Adding a second test that will fail because we call the panic! macro</h4>

<p>Run the tests again using <code class="language-plaintext highlighter-rouge">cargo test</code>. The output should look like Listing 11-4, which shows that our <code class="language-plaintext highlighter-rouge">exploration</code> test passed and <code class="language-plaintext highlighter-rouge">another</code> failed.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">exploration</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">another</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">another</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">another</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'Make</span> <span class="n">this</span> <span class="n">test</span> <span class="k">fail</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.

failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">another</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

<span class="n">error</span><span class="p">:</span> <span class="n">test</span> <span class="n">failed</span>
</code></pre></div></div>
<h4 id="listing-11-4-test-results-when-one-test-passes-and-one-test-fails">Listing 11-4: Test results when one test passes and one test fails</h4>

<p>Instead of <code class="language-plaintext highlighter-rouge">ok</code>, the line <code class="language-plaintext highlighter-rouge">test tests::another</code> shows <code class="language-plaintext highlighter-rouge">FAILED</code>. 
Two new sections appear between the individual results and the summary: 
the first section displays the detailed reason for each test failure. 
In this case, <code class="language-plaintext highlighter-rouge">another</code> failed because it <code class="language-plaintext highlighter-rouge">panicked at 'Make this test fail'</code>, which happened on line 10 in the <em>src/lib.rs</em> file. 
The next section lists just the names of all the failing tests, which is useful when there are lots of tests and lots of detailed failing test output. 
We can use the name of a failing test to run just that test to more easily debug it; 
we’ll talk more about ways to run tests in the <a href="#controlling-how-tests-are-run">“Controlling How Tests Are Run”</a> section.</p>

<h3 id="checking-results-with-the-assert-macro">Checking Results with the assert! Macro</h3>
<p>The <code class="language-plaintext highlighter-rouge">assert!</code> macro, provided by the standard library, is useful when you want to ensure that some condition in a test evaluates to <code class="language-plaintext highlighter-rouge">true</code>. 
We give the <code class="language-plaintext highlighter-rouge">assert!</code> macro an argument that evaluates to a <strong>Boolean</strong>. 
If the value is <strong>true</strong>, <code class="language-plaintext highlighter-rouge">assert!</code> does nothing and the test passes. 
If the value is <strong>false</strong>, the <code class="language-plaintext highlighter-rouge">assert!</code> macro calls the <code class="language-plaintext highlighter-rouge">panic!</code> macro, which causes the test to fail. 
Using the <code class="language-plaintext highlighter-rouge">assert!</code> macro helps us check that our code is functioning in the way we intend.</p>

<p>In Chapter 5, Listing 5-15, we used a <code class="language-plaintext highlighter-rouge">Rectangle</code> struct and a <code class="language-plaintext highlighter-rouge">can_hold</code> method, which are repeated here in Listing 11-5. 
Let’s put this code in the <em>src/lib.rs</em> file and write some tests for it using the <code class="language-plaintext highlighter-rouge">assert!</code> macro.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Rectangle</span> <span class="p">{</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">u32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Rectangle</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">can_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Rectangle</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.width</span> <span class="o">&gt;</span> <span class="n">other</span><span class="py">.width</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.height</span> <span class="o">&gt;</span> <span class="n">other</span><span class="py">.height</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-5-using-the-rectangle-struct-and-its-can_hold-method-from-chapter-5">Listing 11-5: Using the Rectangle struct and its can_hold method from Chapter 5</h4>

<p>The <code class="language-plaintext highlighter-rouge">can_hold</code> method returns a Boolean, which means it’s a perfect use case for the <code class="language-plaintext highlighter-rouge">assert!</code> macro. 
In Listing 11-6, we write a test that exercises the <code class="language-plaintext highlighter-rouge">can_hold</code> method by creating a <code class="language-plaintext highlighter-rouge">Rectangle</code> instance that has a width of 8 and a height of 7 and asserting that it can hold another <code class="language-plaintext highlighter-rouge">Rectangle</code> instance that has a width of 5 and a height of 1.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">larger_can_hold_smaller</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">larger</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">7</span> <span class="p">};</span>
        <span class="k">let</span> <span class="n">smaller</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">1</span> <span class="p">};</span>

        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">larger</span><span class="nf">.can_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="n">smaller</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-6-a-test-for-can_hold-that-checks-whether-a-larger-rectangle-can-indeed-hold-a-smaller-rectangle">Listing 11-6: A test for can_hold that checks whether a larger rectangle can indeed hold a smaller rectangle</h4>

<p>Note that we’ve added a new line inside the <code class="language-plaintext highlighter-rouge">tests</code> module: <code class="language-plaintext highlighter-rouge">use super::*;</code>. 
The tests module is a regular module that follows the usual visibility rules we covered in Chapter 7 in the <a href="../7.Managing-Growing-Projects-with-Packages,-Crates,-and-Modules/#paths-for-referring-to-an-item-in-the-module-tree">“Paths for Referring to an Item in the Module Tree”</a> section. 
Because the tests module is an inner module, we need to bring the code under test in the outer module into the scope of the inner module. 
We use a glob<code class="language-plaintext highlighter-rouge">(*)</code> here so anything we define in the outer module is available to this <code class="language-plaintext highlighter-rouge">tests</code> module.</p>

<p>We’ve named our test <code class="language-plaintext highlighter-rouge">larger_can_hold_smaller</code>, and we’ve created the two <code class="language-plaintext highlighter-rouge">Rectangle</code> instances that we need. 
Then we called the <code class="language-plaintext highlighter-rouge">assert!</code> macro and passed it the result of calling <code class="language-plaintext highlighter-rouge">larger.can_hold(&amp;smaller)</code>. 
This expression is supposed to return <code class="language-plaintext highlighter-rouge">true</code>, so our test should pass. Let’s find out!</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>It does pass! Let’s add another test, this time asserting that a smaller rectangle cannot hold a larger rectangle:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">larger_can_hold_smaller</span><span class="p">()</span> <span class="p">{</span>
        <span class="c">// --snip--</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">smaller_cannot_hold_larger</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">larger</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">7</span> <span class="p">};</span>
        <span class="k">let</span> <span class="n">smaller</span> <span class="o">=</span> <span class="n">Rectangle</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">1</span> <span class="p">};</span>

        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="o">!</span><span class="n">smaller</span><span class="nf">.can_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="n">larger</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Because the correct result of the <code class="language-plaintext highlighter-rouge">can_hold</code> function in this case is <code class="language-plaintext highlighter-rouge">false</code>, we need to negate that result before we pass it to the <code class="language-plaintext highlighter-rouge">assert!</code> macro. 
As a result, our test will pass if <code class="language-plaintext highlighter-rouge">can_hold</code> returns false:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">smaller_cannot_hold_larger</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 2</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>Two tests that pass! Now let’s see what happens to our test results when we introduce a bug in our code. 
Let’s change the implementation of the <code class="language-plaintext highlighter-rouge">can_hold</code> method by replacing the greater than sign<code class="language-plaintext highlighter-rouge">(&gt;)</code> with a less than sign<code class="language-plaintext highlighter-rouge">(&lt;)</code> when it compares the widths:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// --snip--</span>

<span class="k">impl</span> <span class="n">Rectangle</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">can_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">Rectangle</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.width</span> <span class="o">&lt;</span> <span class="n">other</span><span class="py">.width</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.height</span> <span class="o">&gt;</span> <span class="n">other</span><span class="py">.height</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Running the tests now produces the following:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">smaller_cannot_hold_larger</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span>
<span class="n">larger</span><span class="nf">.can_hold</span><span class="p">(</span><span class="o">&amp;</span><span class="n">smaller</span><span class="p">)</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.

failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">larger_can_hold_smaller</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Our tests caught the <strong>bug</strong>! 
Because <code class="language-plaintext highlighter-rouge">larger.width</code> is 8 and <code class="language-plaintext highlighter-rouge">smaller.width</code> is 5, the comparison of the widths in <code class="language-plaintext highlighter-rouge">can_hold</code> now returns false: 8 is not less than 5.</p>

<h3 id="testing-equality-with-the-assert_eq-and-assert_ne-macros">Testing Equality with the assert_eq! and assert_ne! Macros</h3>

<p>A common way to test functionality is to compare the result of the code under test to the value you expect the code to return to make sure they’re equal. 
You could do this using the <code class="language-plaintext highlighter-rouge">assert!</code> macro and passing it an expression using the <code class="language-plaintext highlighter-rouge">==</code> operator. 
However, this is such a common test that the standard library provides a pair of macros—<code class="language-plaintext highlighter-rouge">assert_eq!</code> and <code class="language-plaintext highlighter-rouge">assert_ne!</code>—to perform this test more conveniently. 
These macros compare two arguments for equality or inequality, respectively. 
They’ll also print the two values if the assertion fails, which <strong>makes it easier to see why the test failed</strong>; 
conversely, the <code class="language-plaintext highlighter-rouge">assert!</code> macro only indicates that it got a <code class="language-plaintext highlighter-rouge">false</code> value for the <code class="language-plaintext highlighter-rouge">==</code> expression, not the values that lead to the <code class="language-plaintext highlighter-rouge">false</code> value.</p>

<p>In Listing 11-7, we write a function named <code class="language-plaintext highlighter-rouge">add_two</code> that adds <code class="language-plaintext highlighter-rouge">2</code> to its parameter and returns the result. 
Then we test this function using the <code class="language-plaintext highlighter-rouge">assert_eq!</code> macro.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">it_adds_two</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nf">add_two</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-7-testing-the-function-add_two-using-the-assert_eq-macro">Listing 11-7: Testing the function add_two using the assert_eq! macro</h4>

<p>Let’s check that it passes!</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">it_adds_two</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>The first argument we gave to the <code class="language-plaintext highlighter-rouge">assert_eq!</code> macro, <code class="language-plaintext highlighter-rouge">4</code>, is equal to the result of calling <code class="language-plaintext highlighter-rouge">add_two(2)</code>. 
The line for this test is test <code class="language-plaintext highlighter-rouge">tests::it_adds_two ... ok</code>, and the <code class="language-plaintext highlighter-rouge">ok</code> text indicates that our test passed!</p>

<p>Let’s introduce a bug into our code to see what it looks like when a test that uses <code class="language-plaintext highlighter-rouge">assert_eq!</code> fails. 
Change the implementation of the <code class="language-plaintext highlighter-rouge">add_two</code> function to instead add <code class="language-plaintext highlighter-rouge">3</code>:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">+</span> <span class="mi">3</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Run the tests again:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">it_adds_two</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">it_adds_two</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">it_adds_two</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span> <span class="err">`</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">)</span><span class="err">`</span>
  <span class="n">left</span><span class="p">:</span> <span class="err">`</span><span class="mi">4</span><span class="err">`</span><span class="p">,</span>
 <span class="n">right</span><span class="p">:</span> <span class="err">`</span><span class="mi">5</span><span class="err">`'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.

failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">it_adds_two</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Our test caught the <strong>bug</strong>! 
The <code class="language-plaintext highlighter-rouge">it_adds_two</code> test failed, displaying the message assertion failed: <code class="language-plaintext highlighter-rouge">'(left == right)'</code> and showing that <code class="language-plaintext highlighter-rouge">left</code> was <code class="language-plaintext highlighter-rouge">4</code> and <code class="language-plaintext highlighter-rouge">right</code> was <code class="language-plaintext highlighter-rouge">5</code>. 
This message is useful and helps us start debugging: it means the <code class="language-plaintext highlighter-rouge">left</code> argument to <code class="language-plaintext highlighter-rouge">assert_eq!</code> was <code class="language-plaintext highlighter-rouge">4</code> but the <code class="language-plaintext highlighter-rouge">right</code> argument, where we had <code class="language-plaintext highlighter-rouge">add_two(2)</code>, was <code class="language-plaintext highlighter-rouge">5</code>.</p>

<p>Note that in some languages and test frameworks, the parameters to the functions that assert two values are equal are called <code class="language-plaintext highlighter-rouge">expected</code> and <code class="language-plaintext highlighter-rouge">actual</code>, and the order in which we specify the arguments matters. 
However, in Rust, they’re called <code class="language-plaintext highlighter-rouge">left</code> and <code class="language-plaintext highlighter-rouge">right</code>, and the order in which we specify the value we expect and the value that the code under test produces doesn’t matter. 
We could write the assertion in this test as <code class="language-plaintext highlighter-rouge">assert_eq!(add_two(2), 4)</code>, which would result in a failure message that displays <code class="language-plaintext highlighter-rouge">assertion failed: '(left == right)'</code> and that <code class="language-plaintext highlighter-rouge">left</code> was <code class="language-plaintext highlighter-rouge">5</code> and <code class="language-plaintext highlighter-rouge">right</code> was <code class="language-plaintext highlighter-rouge">4</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">assert_ne!</code> macro will pass if the two values we give it are not equal and fail if they’re equal. 
This macro is most useful for cases when we’re not sure what a value <em>will</em> be, but we know what the value definitely <em>won’t</em> be if our code is functioning as we intend. 
For example, if we’re testing a function that is guaranteed to change its input in some way, but the way in which the input is changed depends on the day of the week that we run our tests, the best thing to assert might be that the output of the function is not equal to the input.</p>

<p>Under the surface, the <code class="language-plaintext highlighter-rouge">assert_eq!</code> and <code class="language-plaintext highlighter-rouge">assert_ne!</code> macros use the operators <code class="language-plaintext highlighter-rouge">==</code> and <code class="language-plaintext highlighter-rouge">!=</code>, respectively. 
When the assertions fail, these macros print their arguments using debug formatting, which means the values being compared must implement the <code class="language-plaintext highlighter-rouge">PartialEq</code> and <code class="language-plaintext highlighter-rouge">Debug</code> traits. A
ll the primitive types and most of the standard library types implement these traits. 
For structs and enums that you define, you’ll need to implement <code class="language-plaintext highlighter-rouge">PartialEq</code> to assert that values of those types are equal or not equal. 
You’ll need to implement <code class="language-plaintext highlighter-rouge">Debug</code> to print the values when the assertion fails. 
Because both traits are <code class="language-plaintext highlighter-rouge">derivable</code> traits, as mentioned in Listing 5-12 in Chapter 5, this is usually as straightforward as adding the <code class="language-plaintext highlighter-rouge">#[derive(PartialEq, Debug)]</code> annotation to your struct or enum definition. 
See Appendix C, “Derivable Traits,” for more details about these and other derivable traits.</p>

<h3 id="adding-custom-failure-messages">Adding Custom Failure Messages</h3>
<p>You can also add a custom message to be printed with the failure message as optional arguments to the <code class="language-plaintext highlighter-rouge">assert!</code>, <code class="language-plaintext highlighter-rouge">assert_eq!</code>, and <code class="language-plaintext highlighter-rouge">assert_ne!</code> macros. 
Any arguments specified after the one required argument to <code class="language-plaintext highlighter-rouge">assert!</code> or the two required arguments to <code class="language-plaintext highlighter-rouge">assert_eq!</code> and <code class="language-plaintext highlighter-rouge">assert_ne!</code> are passed along to the <code class="language-plaintext highlighter-rouge">format!</code> macro (discussed in Chapter 8 in the <a href="../8.Common-Collections/#concatenation-with-the--operator-or-the-format-macro">“Concatenation with the + Operator or the format! Macro”</a> section), so you can pass a format string that contains <code class="language-plaintext highlighter-rouge">{}</code> placeholders and values to go in those placeholders. 
Custom messages are useful to document what an assertion means; when a test fails, you’ll have a better idea of what the problem is with the code.</p>

<p>For example, let’s say we have a function that greets people by name and we want to test that the name we pass into the function appears in the output:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nd">format!</span><span class="p">(</span><span class="s">"Hello {}!"</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">greeting_contains_name</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nf">greeting</span><span class="p">(</span><span class="s">"Carol"</span><span class="p">);</span>
        <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="n">result</span><span class="nf">.contains</span><span class="p">(</span><span class="s">"Carol"</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>The requirements for this program haven’t been agreed upon yet, and we’re pretty sure the <code class="language-plaintext highlighter-rouge">Hello</code> text at the beginning of the greeting will change. 
We decided we don’t want to have to update the test when the requirements change, so instead of checking for exact equality to the value returned from the <code class="language-plaintext highlighter-rouge">greeting</code> function, we’ll just assert that the output contains the text of the input parameter.</p>

<p>Let’s introduce a bug into this code by changing <code class="language-plaintext highlighter-rouge">greeting</code> to not include <code class="language-plaintext highlighter-rouge">name</code> to see what this test failure looks like:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"Hello!"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Running this test produces the following:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greeting_contains_name</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greeting_contains_name</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">greeting_contains_name</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span>
<span class="n">result</span><span class="nf">.contains</span><span class="p">(</span><span class="s">"Carol"</span><span class="p">)</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.

failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">greeting_contains_name</span>
</code></pre></div></div>

<p>This result just indicates that the assertion failed and which line the assertion is on. 
A more useful failure message in this case would print the value we got from the <code class="language-plaintext highlighter-rouge">greeting</code> function. 
Let’s change the test function, giving it a custom failure message made from a format string with a placeholder filled in with the actual value we got from the <code class="language-plaintext highlighter-rouge">greeting</code> function:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">greeting_contains_name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nf">greeting</span><span class="p">(</span><span class="s">"Carol"</span><span class="p">);</span>
    <span class="k">assert</span><span class="o">!</span><span class="p">(</span>
        <span class="n">result</span><span class="nf">.contains</span><span class="p">(</span><span class="s">"Carol"</span><span class="p">),</span>
        <span class="s">"Greeting did not contain name, value was `{}`"</span><span class="p">,</span> <span class="n">result</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Now when we run the test, we’ll get a more informative error message:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greeting_contains_name</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">greeting_contains_name</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'Greeting</span> <span class="n">did</span> <span class="n">not</span>
<span class="n">contain</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="n">was</span> <span class="err">`</span><span class="nd">Hello!</span>`'<span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> `<span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span>` <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span>.
</code></pre></div></div>
<p>We can see the value we actually got in the test output, which would help us debug what happened instead of what we were expecting to happen.</p>

<h3 id="checking-for-panics-with-should_panic">Checking for Panics with should_panic</h3>
<p>In addition to checking that our code returns the correct values we expect, it’s also important to check that our code handles error conditions as we expect. 
For example, consider the <code class="language-plaintext highlighter-rouge">Guess</code> type that we created in Chapter 9, Listing 9-10. 
Other code that uses <code class="language-plaintext highlighter-rouge">Guess</code> depends on the guarantee that <code class="language-plaintext highlighter-rouge">Guess</code> instances will contain only values between 1 and 100. 
We can write a test that ensures that attempting to create a <code class="language-plaintext highlighter-rouge">Guess</code> instance with a value outside that range panics.</p>

<p>We do this by adding another attribute, <code class="language-plaintext highlighter-rouge">should_panic</code>, to our test function. 
This attribute makes a test pass if the code inside the function panics; the test will fail if the code inside the function doesn’t panic.</p>

<p>Listing 11-8 shows a test that checks that the error conditions of <code class="language-plaintext highlighter-rouge">Guess::new</code> happen when we expect them to.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">Guess</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Guess</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Guess</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">||</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
            <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be between 1 and 100, got {}."</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Guess</span> <span class="p">{</span>
            <span class="n">value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="nd">#[should_panic]</span>
    <span class="k">fn</span> <span class="nf">greater_than_100</span><span class="p">()</span> <span class="p">{</span>
        <span class="nn">Guess</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-8-testing-that-a-condition-will-cause-a-panic">Listing 11-8: Testing that a condition will cause a panic!</h4>

<p>We place the <code class="language-plaintext highlighter-rouge">#[should_panic]</code> attribute after the <code class="language-plaintext highlighter-rouge">#[test]</code> attribute and before the test function it applies to. 
Let’s look at the result when this test passes:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Looks good! Now let’s introduce a bug in our code by removing the condition that the <code class="language-plaintext highlighter-rouge">new</code> function will panic if the value is greater than 100:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// --snip--</span>
<span class="k">impl</span> <span class="n">Guess</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Guess</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span>  <span class="p">{</span>
            <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be between 1 and 100, got {}."</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Guess</span> <span class="p">{</span>
            <span class="n">value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>When we run the test in Listing 11-8, it will fail:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="n">failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>We don’t get a very helpful message in this case, but when we look at the test function, we see that it’s annotated with <code class="language-plaintext highlighter-rouge">#[should_panic]</code>. 
The failure we got means that the code in the test function did not cause a panic.</p>

<p>Tests that use <code class="language-plaintext highlighter-rouge">should_panic</code> can be imprecise because they only indicate that the code has caused some panic. 
A <code class="language-plaintext highlighter-rouge">should_panic</code> test would pass even if the test panics for a different reason from the one we were expecting to happen. 
To make <code class="language-plaintext highlighter-rouge">should_panic</code> tests more precise, we can add an optional <code class="language-plaintext highlighter-rouge">expected</code> parameter to the <code class="language-plaintext highlighter-rouge">should_panic</code> attribute. 
The test harness will make sure that the failure message contains the provided text. 
For example, consider the modified code for <code class="language-plaintext highlighter-rouge">Guess</code> in Listing 11-9 where the <code class="language-plaintext highlighter-rouge">new</code> function panics with different messages depending on whether the value is too small or too large.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// --snip--</span>

<span class="k">impl</span> <span class="n">Guess</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Guess</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be greater than or equal to 1, got {}."</span><span class="p">,</span>
                   <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
            <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be less than or equal to 100, got {}."</span><span class="p">,</span>
                   <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Guess</span> <span class="p">{</span>
            <span class="n">value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="nd">#[should_panic(expected</span> <span class="nd">=</span> <span class="s">"Guess value must be less than or equal to 100"</span><span class="nd">)]</span>
    <span class="k">fn</span> <span class="nf">greater_than_100</span><span class="p">()</span> <span class="p">{</span>
        <span class="nn">Guess</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-9-testing-that-a-condition-will-cause-a-panic-with-a-particular-panic-message">Listing 11-9: Testing that a condition will cause a panic! with a particular panic message</h4>
<p>This test will pass because the value we put in the <code class="language-plaintext highlighter-rouge">should_panic</code> attribute’s <code class="language-plaintext highlighter-rouge">expected</code> parameter is a substring of the message that the <code class="language-plaintext highlighter-rouge">Guess::new</code> function panics with. 
We could have specified the entire panic message that we expect, which in this case would be <code class="language-plaintext highlighter-rouge">Guess value must be less than or equal to 100, got 200</code>. 
What you choose to specify in the expected parameter for <code class="language-plaintext highlighter-rouge">should_panic</code> depends on how much of the panic message is unique or dynamic and how precise you want your test to be. 
In this case, a substring of the panic message is enough to ensure that the code in the test function executes the <code class="language-plaintext highlighter-rouge">else if value &gt; 100</code> case.</p>

<p>To see what happens when a <code class="language-plaintext highlighter-rouge">should_panic</code> test with an <code class="language-plaintext highlighter-rouge">expected</code> message fails, let’s again introduce a bug into our code by swapping the bodies of the <code class="language-plaintext highlighter-rouge">if value &lt; 1</code> and the else <code class="language-plaintext highlighter-rouge">if value &gt; 100</code> blocks:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">{</span>
    <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be less than or equal to 100, got {}."</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="p">{</span>
    <span class="nd">panic!</span><span class="p">(</span><span class="s">"Guess value must be greater than or equal to 1, got {}."</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This time when we run the should_panic test, it will fail:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">greater_than_100</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'Guess</span> <span class="n">value</span> <span class="n">must</span> <span class="n">be</span>
<span class="n">greater</span> <span class="n">than</span> <span class="n">or</span> <span class="n">equal</span> <span class="n">to</span> <span class="mi">1</span><span class="p">,</span> <span class="n">got</span> <span class="mi">200</span><span class="err">.'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">13</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.
note</span><span class="p">:</span> <span class="n">Panic</span> <span class="n">did</span> <span class="n">not</span> <span class="n">include</span> <span class="n">expected</span> <span class="n">string</span> <span class="nv">'Guess</span> <span class="n">value</span> <span class="n">must</span> <span class="n">be</span> <span class="n">less</span> <span class="n">than</span> <span class="n">or</span>
<span class="n">equal</span> <span class="n">to</span> <span class="mi">100</span><span class="err">'</span>

<span class="n">failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">greater_than_100</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>The failure message indicates that this test did indeed panic as we expected, but the panic message did not include the expected string ‘<code class="language-plaintext highlighter-rouge">Guess value must be less than or equal to 100'</code>. 
The panic message that we did get in this case was <code class="language-plaintext highlighter-rouge">Guess value must be greater than or equal to 1, got 200.</code> Now we can start figuring out where our bug is!</p>

<h3 id="using-resultt-e-in-tests">Using Result&lt;T, E&gt; in Tests</h3>
<p>So far, we’ve written tests that panic when they fail. 
We can also write tests that use <code class="language-plaintext highlighter-rouge">Result&lt;T, E&gt;</code>! 
Here’s the test from Listing 11-1, rewritten to use <code class="language-plaintext highlighter-rouge">Result&lt;T, E&gt;</code> and return an <code class="language-plaintext highlighter-rouge">Err</code> instead of panicking:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">it_works</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">(())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nn">String</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"two plus two does not equal four"</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">it_works</code> function now has a return type, <code class="language-plaintext highlighter-rouge">Result&lt;(), String&gt;</code>. 
In the body of the function, rather than calling the <code class="language-plaintext highlighter-rouge">assert_eq!</code> macro, we return <code class="language-plaintext highlighter-rouge">Ok(())</code> when the test passes and an <code class="language-plaintext highlighter-rouge">Err</code> with a <code class="language-plaintext highlighter-rouge">String</code> inside when the test fails.</p>

<p>Writing tests so they return a <code class="language-plaintext highlighter-rouge">Result&lt;T, E&gt;</code> enables you to use the question mark operator in the body of tests, 
which can be a convenient way to write tests that should fail if any operation within them returns an Err variant.</p>

<p>You can’t use the <code class="language-plaintext highlighter-rouge">#[should_panic]</code> annotation on tests that use<code class="language-plaintext highlighter-rouge"> Result&lt;T, E&gt;</code>. 
Instead, you should return an <code class="language-plaintext highlighter-rouge">Err</code> value directly when the test should fail.</p>

<p>Now that you know several ways to write tests, let’s look at what is happening when we run our tests and explore the different options we can use with <code class="language-plaintext highlighter-rouge">cargo test</code>.</p>

<h2 id="controlling-how-tests-are-run">Controlling How Tests Are Run</h2>
<p>Just as <code class="language-plaintext highlighter-rouge">cargo run</code> compiles your code and then runs the resulting binary, <code class="language-plaintext highlighter-rouge">cargo test</code> compiles your code in test mode and runs the resulting test binary. 
You can specify command line options to change the default behavior of <code class="language-plaintext highlighter-rouge">cargo test</code>. 
For example, the default behavior of the binary produced by <code class="language-plaintext highlighter-rouge">cargo test</code> is to run all the tests in parallel and capture output generated during test runs, preventing the output from being displayed and making it easier to read the output related to the test results.</p>

<p>Some command line options go to <code class="language-plaintext highlighter-rouge">cargo test</code>, and some go to the resulting test binary. 
To separate these two types of arguments, you list the arguments that go to <code class="language-plaintext highlighter-rouge">cargo test</code> followed by the separator <code class="language-plaintext highlighter-rouge">--</code> and then the ones that go to the test binary. 
Running <code class="language-plaintext highlighter-rouge">cargo test --help</code> displays the options you can use with <code class="language-plaintext highlighter-rouge">cargo test</code>, and running <code class="language-plaintext highlighter-rouge">cargo test -- --help</code> displays the options you can use after the separator <code class="language-plaintext highlighter-rouge">--</code>.</p>

<h3 id="running-tests-in-parallel-or-consecutively">Running Tests in Parallel or Consecutively</h3>
<p>When you run multiple tests, by default they run in parallel using threads. 
This means the tests will finish running faster so you can get feedback quicker on whether or not your code is working. 
Because the tests are running at the same time, make sure your tests don’t depend on each other or on any shared state, including a shared environment, such as the current working directory or environment variables.</p>

<p>For example, say each of your tests runs some code that creates a file on disk named test-output.txt and writes some data to that file. 
Then each test reads the data in that file and asserts that the file contains a particular value, which is different in each test. 
Because the tests run at the same time, one test might overwrite the file between when another test writes and reads the file. 
The second test will then fail, not because the code is incorrect but because the tests have interfered with each other while running in parallel. 
One solution is to make sure each test writes to a different file; another solution is to run the tests one at a time.</p>

<p>If you don’t want to run the tests in parallel or if you want more fine-grained control over the number of threads used, you can send the <code class="language-plaintext highlighter-rouge">--test-threads</code> flag and the number of threads you want to use to the test binary. Take a look at the following example:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="o">--</span> <span class="o">--</span><span class="n">test</span><span class="o">-</span><span class="n">threads</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div></div>
<p>We set the number of test threads to 1, telling the program not to use any parallelism. 
Running the tests using one thread will take longer than running them in parallel, but the tests won’t interfere with each other if they share state.</p>

<h3 id="showing-function-output">Showing Function Output</h3>
<p>By default, if a test passes, Rust’s test library captures anything printed to standard output. 
For example, if we call <code class="language-plaintext highlighter-rouge">println!</code> in a test and the test passes, we won’t see the <code class="language-plaintext highlighter-rouge">println!</code> output in the terminal; we’ll see only the line that indicates the test passed. 
If a test fails, we’ll see whatever was printed to standard output with the rest of the failure message.</p>

<p>As an example, Listing 11-10 has a silly function that prints the value of its parameter and returns 10, as well as a test that passes and a test that fails.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">prints_and_returns_10</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"I got the value {}"</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    <span class="mi">10</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">this_test_will_pass</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="nf">prints_and_returns_10</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">this_test_will_fail</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">value</span> <span class="o">=</span> <span class="nf">prints_and_returns_10</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-10-tests-for-a-function-that-calls-println">Listing 11-10: Tests for a function that calls println!</h4>

<p>When we run these tests with <code class="language-plaintext highlighter-rouge">cargo test</code>, we’ll see the following output:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_pass</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_fail</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_fail</span> <span class="n">stdout</span> <span class="o">----</span>
<span class="n">I</span> <span class="n">got</span> <span class="n">the</span> <span class="n">value</span> <span class="mi">8</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">this_test_will_fail</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span> <span class="err">`</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">)</span><span class="err">`</span>
  <span class="n">left</span><span class="p">:</span> <span class="err">`</span><span class="mi">5</span><span class="err">`</span><span class="p">,</span>
 <span class="n">right</span><span class="p">:</span> <span class="err">`</span><span class="mi">10</span><span class="err">`'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.

failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_fail</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Note that nowhere in this output do we see <code class="language-plaintext highlighter-rouge">I got the value 4</code>, which is what is printed when the test that passes runs. 
That output has been captured. 
The output from the test that failed, <code class="language-plaintext highlighter-rouge">I got the value 8</code>, appears in the section of the test summary output, which also shows the cause of the test failure.</p>

<p>If we want to see <strong>printed values for passing tests as well</strong>, we can disable the output capture behavior by using the <code class="language-plaintext highlighter-rouge">--nocapture</code> flag:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="o">--</span> <span class="o">--</span><span class="n">nocapture</span>
</code></pre></div></div>
<p>When we run the tests in Listing 11-10 again with the <code class="language-plaintext highlighter-rouge">--nocapture</code> flag, we see the following output:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">I</span> <span class="n">got</span> <span class="n">the</span> <span class="n">value</span> <span class="mi">4</span>
<span class="n">I</span> <span class="n">got</span> <span class="n">the</span> <span class="n">value</span> <span class="mi">8</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_pass</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">this_test_will_fail</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span> <span class="err">`</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">)</span><span class="err">`</span>
  <span class="n">left</span><span class="p">:</span> <span class="err">`</span><span class="mi">5</span><span class="err">`</span><span class="p">,</span>
 <span class="n">right</span><span class="p">:</span> <span class="err">`</span><span class="mi">10</span><span class="err">`'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">9</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.
test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_fail</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="n">failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">this_test_will_fail</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Note that the output for the tests and the test results are interleaved; 
the reason is that the tests are running in parallel, as we talked about in the previous section. 
Try using the <code class="language-plaintext highlighter-rouge">--test-threads=1</code> option and the <code class="language-plaintext highlighter-rouge">--nocapture</code> flag, and see what the output looks like then!</p>

<h3 id="running-a-subset-of-tests-by-name">Running a Subset of Tests by Name</h3>
<p>Sometimes, running a full test suite can take a long time. 
If you’re working on code in a particular area, you might want to run only the tests pertaining to that code. 
You can choose which tests to run by passing <code class="language-plaintext highlighter-rouge">cargo test</code> the name or names of the test(s) you want to run as an argument.</p>

<p>To demonstrate how to run a subset of tests, we’ll create three tests for our <code class="language-plaintext highlighter-rouge">add_two</code> function, as shown in Listing 11-11, and choose which ones to run.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">add_two_and_two</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nf">add_two</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">add_three_and_two</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nf">add_two</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">one_hundred</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="nf">add_two</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-11-three-tests-with-three-different-names">Listing 11-11: Three tests with three different names</h4>

<p>If we run the tests without passing any arguments, as we saw earlier, all the tests will run in parallel:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">3</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">add_two_and_two</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">add_three_and_two</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">one_hundred</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 3</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<h3 id="running-single-tests">Running Single Tests</h3>
<p>We can pass the name of any test function to <code class="language-plaintext highlighter-rouge">cargo test</code> to run only that test:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="n">one_hundred</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="mi">06</span><span class="n">a75b4a1f2515e9</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">one_hundred</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">2</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Only the test with the name <code class="language-plaintext highlighter-rouge">one_hundred</code> ran; the other two tests didn’t match that name. 
The test output lets us know we had more tests than what this command ran by displaying <code class="language-plaintext highlighter-rouge">2 filtered out</code> at the end of the summary line.</p>

<p>We can’t specify the names of multiple tests in this way; only the first value given to <code class="language-plaintext highlighter-rouge">cargo test</code> will be used. 
But there is a way to run multiple tests.</p>

<h3 id="filtering-to-run-multiple-tests">Filtering to Run Multiple Tests</h3>
<p>We can specify part of a test name, and any test whose name matches that value will be run. 
For example, because two of our tests’ names contain <code class="language-plaintext highlighter-rouge">add</code>, we can run those two by running <code class="language-plaintext highlighter-rouge">cargo test add</code>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="n">add</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="mi">06</span><span class="n">a75b4a1f2515e9</span>

<span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">add_two_and_two</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">add_three_and_two</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 2</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">1</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>This command ran all tests with <code class="language-plaintext highlighter-rouge">add</code> in the name and filtered out the test named <code class="language-plaintext highlighter-rouge">one_hundred</code>. 
Also note that the module in which a test appears becomes part of the test’s name, so we can run all the tests in a module by filtering on the module’s name.</p>

<h3 id="ignoring-some-tests-unless-specifically-requested">Ignoring Some Tests Unless Specifically Requested</h3>
<p>Sometimes a few specific tests can be very time-consuming to execute, so you might want to exclude them during most runs of <code class="language-plaintext highlighter-rouge">cargo test</code>. 
Rather than listing as arguments all tests you do want to run, you can instead annotate the time-consuming tests using the <code class="language-plaintext highlighter-rouge">ignore</code> attribute to exclude them, as shown here:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#![allow(unused_variables)]</span>
  <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nd">#[test]</span>
  <span class="k">fn</span> <span class="nf">it_works</span><span class="p">()</span> <span class="p">{</span>
      <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">#[test]</span>
  <span class="nd">#[ignore]</span>
  <span class="k">fn</span> <span class="nf">expensive_test</span><span class="p">()</span> <span class="p">{</span>
      <span class="c">// code that takes an hour to run</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>After <code class="language-plaintext highlighter-rouge">#[test]</code> we add the <code class="language-plaintext highlighter-rouge">#[ignore]</code> line to the test we want to exclude. 
Now when we run our tests, <code class="language-plaintext highlighter-rouge">it_works</code> runs, but <code class="language-plaintext highlighter-rouge">expensive_test</code> doesn’t:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span>
   <span class="n">Compiling</span> <span class="n">adder</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="c">///projects/adder)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.24</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="n">ce99bcc2479f4607</span>

<span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="n">expensive_test</span> <span class="o">...</span> <span class="n">ignored</span>
<span class="n">test</span> <span class="n">it_works</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">expensive_test</code> function is listed as ignored. 
If we want to run only the ignored tests, we can use <code class="language-plaintext highlighter-rouge">cargo test -- --ignored</code>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="o">--</span> <span class="o">--</span><span class="n">ignored</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="n">ce99bcc2479f4607</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="n">expensive_test</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">1</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>By controlling which tests run, you can make sure your <code class="language-plaintext highlighter-rouge">cargo test</code> results will be fast. 
When you’re at a point where it makes sense to check the results of the <code class="language-plaintext highlighter-rouge">ignored</code> tests and you have time to wait for the results, you can run <code class="language-plaintext highlighter-rouge">cargo test -- --ignored</code> instead.</p>

<h2 id="test-organization">Test Organization</h2>
<p>As mentioned at the start of the chapter, testing is a complex discipline, and different people use different terminology and organization. 
The Rust community thinks about tests in terms of two main categories: <em>unit tests</em> and <em>integration tests</em>. 
Unit tests are small and more focused, testing one module in isolation at a time, and can test private interfaces. 
Integration tests are entirely external to your library and use your code in the same way any other external code would, using only the public interface and potentially exercising multiple modules per test.</p>

<p>Writing both kinds of tests is important to ensure that the pieces of your library are doing what you expect them to, separately and together.</p>

<h3 id="unit-tests">Unit Tests</h3>
<p>The purpose of unit tests is to test each unit of code in isolation from the rest of the code to quickly pinpoint where code is and isn’t working as expected. 
You’ll put unit tests in the <code class="language-plaintext highlighter-rouge">src</code> directory in each file with the code that they’re testing. 
The convention is to create a module named <code class="language-plaintext highlighter-rouge">tests</code> in each file to contain the test functions and to annotate the module with <code class="language-plaintext highlighter-rouge">cfg(test)</code>.</p>

<h3 id="the-tests-module-and-cfgtest">The Tests Module and #[cfg(test)]</h3>
<p>The <code class="language-plaintext highlighter-rouge">#[cfg(test)]</code> annotation on the tests module tells Rust to compile and run the test code only when you run <code class="language-plaintext highlighter-rouge">cargo test</code>, not when you run <code class="language-plaintext highlighter-rouge">cargo build</code>. 
This saves compile time when you only want to build the library and saves space in the resulting compiled artifact because the tests are not included. 
You’ll see that because integration tests go in a different directory, they don’t need the <code class="language-plaintext highlighter-rouge">#[cfg(test)]</code> annotation. 
However, because unit tests go in the same files as the code, you’ll use <code class="language-plaintext highlighter-rouge">#[cfg(test)]</code> to specify that they shouldn’t be included in the compiled result.</p>

<p>Recall that when we generated the new <code class="language-plaintext highlighter-rouge">adder</code> project in the first section of this chapter, Cargo generated this code for us:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">it_works</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>This code is the automatically generated test module. 
The attribute <code class="language-plaintext highlighter-rouge">cfg</code> stands for configuration and tells Rust that the following item should only be included given a certain configuration option. 
In this case, the configuration option is <code class="language-plaintext highlighter-rouge">test</code>, which is provided by Rust for compiling and running tests. 
By using the <code class="language-plaintext highlighter-rouge">cfg</code> attribute, Cargo compiles our test code only if we actively run the tests with <code class="language-plaintext highlighter-rouge">cargo test</code>. 
This includes any helper functions that might be within this module, in addition to the functions annotated with <code class="language-plaintext highlighter-rouge">#[test]</code>.</p>

<h3 id="testing-private-functions">Testing Private Functions</h3>
<p>There’s debate within the testing community about whether or not private functions should be tested directly, and other languages make it difficult or impossible to test private functions. 
Regardless of which testing ideology you adhere to, Rust’s privacy rules do allow you to test private functions. Consider the code in Listing 11-12 with the private function <code class="language-plaintext highlighter-rouge">internal_adder</code>.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="nf">internal_adder</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">internal_adder</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">i32</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">i32</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">i32</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="p">}</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">internal</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nf">internal_adder</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-12-testing-a-private-function">Listing 11-12: Testing a private function</h4>

<p>Note that the <code class="language-plaintext highlighter-rouge">internal_adder</code> function is not marked as <code class="language-plaintext highlighter-rouge">pub</code>, but because tests are just Rust code and the tests module is just another module, you can bring <code class="language-plaintext highlighter-rouge">internal_adder</code> into a test’s scope and call it. 
If you don’t think private functions should be tested, there’s nothing in Rust that will compel you to do so.</p>

<h3 id="integration-tests">Integration Tests</h3>
<p>In Rust, integration tests are entirely external to your library. 
They use your library in the same way any other code would, which means they can only call functions that are part of your library’s public API. 
Their purpose is to test whether many parts of your library work together correctly. 
Units of code that work correctly on their own could have problems when integrated, so test coverage of the integrated code is important as well. 
To create integration tests, you first need a <code class="language-plaintext highlighter-rouge">tests</code> directory.</p>

<h3 id="the-tests-directory">The tests Directory</h3>
<p>We create a <code class="language-plaintext highlighter-rouge">tests</code> directory at the top level of our project directory, next to <code class="language-plaintext highlighter-rouge">src</code>. 
Cargo knows to look for integration test files in this directory. 
We can then make as many test files as we want to in this directory, and Cargo will compile each of the files as an individual crate.</p>

<p>Let’s create an integration test. 
With the code in Listing 11-12 still in the <em>src/lib.rs</em> file, make a tests directory, create a new file named <em>tests/integration_test.rs</em>, and enter the code in Listing 11-13.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//Filename: tests/integration_test.rs</span>
<span class="k">use</span> <span class="n">adder</span><span class="p">;</span>

<span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">it_adds_two</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nn">adder</span><span class="p">::</span><span class="nf">add_two</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-11-13-an-integration-test-of-a-function-in-the-adder-crate">Listing 11-13: An integration test of a function in the adder crate</h4>

<p>We’ve added <code class="language-plaintext highlighter-rouge">use adder</code> at the top of the code, which we didn’t need in the unit tests. 
The reason is that each file in the <code class="language-plaintext highlighter-rouge">tests</code> directory is a separate crate, so we need to bring our library into each test crate’s scope.</p>

<p>We don’t need to annotate any code in <em>tests/integration_test.rs</em> with <code class="language-plaintext highlighter-rouge">#[cfg(test)]</code>. 
Cargo treats the <code class="language-plaintext highlighter-rouge">tests</code> directory specially and compiles files in this directory only when we run cargo test. 
Run cargo test now:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span>
   <span class="n">Compiling</span> <span class="n">adder</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="c">///projects/adder)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.31</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">adder</span><span class="o">-</span><span class="n">abcabcabc</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">internal</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">integration_test</span><span class="o">-</span><span class="n">ce99bcc2479f4607</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="n">it_adds_two</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

   <span class="n">Doc</span><span class="o">-</span><span class="n">tests</span> <span class="n">adder</span>

<span class="n">running</span> <span class="mi">0</span> <span class="n">tests</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>The three sections of output include the unit tests, the integration test, and the doc tests. 
The first section for the unit tests is the same as we’ve been seeing: one line for each unit test (one named <code class="language-plaintext highlighter-rouge">internal</code> that we added in Listing 11-12) and then a summary line for the unit tests.</p>

<p>The integration tests section starts with the line <code class="language-plaintext highlighter-rouge">Running target/debug/deps/integration_test-ce99bcc2479f4607</code> (the hash at the end of your output will be different). 
Next, there is a line for each test function in that integration test and a summary line for the results of the integration test just before the <code class="language-plaintext highlighter-rouge">Doc-tests adder</code> section starts.</p>

<p>Similarly to how adding more unit test functions adds more result lines to the unit tests section, adding more test functions to the integration test file adds more result lines to this integration test file’s section. 
Each integration test file has its own section, so if we add more files in the tests directory, there will be more integration test sections.</p>

<p>We can still run a particular integration test function by specifying the test function’s name as an argument to <code class="language-plaintext highlighter-rouge">cargo test</code>. 
To run all the tests in a particular integration test file, use the <code class="language-plaintext highlighter-rouge">--test</code> argument of <code class="language-plaintext highlighter-rouge">cargo test</code> followed by the name of the file:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span> <span class="o">--</span><span class="n">test</span> <span class="n">integration_test</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">integration_test</span><span class="o">-</span><span class="mi">952</span><span class="n">a27e0126bb565</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="n">it_adds_two</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>This command runs only the tests in the <em>tests/integration_test.rs</em> file.</p>

<h3 id="submodules-in-integration-tests">Submodules in Integration Tests</h3>
<p>As you add more integration tests, you might want to make more than one file in the <code class="language-plaintext highlighter-rouge">tests</code> directory to help organize them; for example, you can group the test functions by the functionality they’re testing. 
As mentioned earlier, each file in the <code class="language-plaintext highlighter-rouge">tests</code> directory is compiled as its own separate crate.</p>

<p>Treating each integration test file as its own crate is useful to create separate scopes that are more like the way end users will be using your crate. 
However, this means files in the <code class="language-plaintext highlighter-rouge">tests</code> directory don’t share the same behavior as files in <code class="language-plaintext highlighter-rouge">src</code> do, as you learned in Chapter 7 regarding how to separate code into modules and files.</p>

<p>The different behavior of files in the tests directory is most noticeable when you have a set of helper functions that would be useful in multiple integration test files and you try to follow the steps in the <a href="../7.Managing-Growing-Projects-with-Packages,-Crates,-and-Modules/#separating-modules-into-different-files">“Separating Modules into Different Files”</a> section of Chapter 7 to extract them into a common module. 
For example, if we create <em>tests/common.rs</em> and place a function named <code class="language-plaintext highlighter-rouge">setup</code> in it, we can add some code to setup that we want to call from multiple test functions in multiple test files:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//Filename: tests/common.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c">// setup code specific to your library's tests would go here</span>
<span class="p">}</span>
</code></pre></div></div>
<p>When we run the tests again, we’ll see a new section in the test output for the <em>common.rs</em> file, even though this file doesn’t contain any test functions nor did we call the setup function from anywhere:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">internal</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">common</span><span class="o">-</span><span class="n">b8b07b6f1be2db70</span>

<span class="n">running</span> <span class="mi">0</span> <span class="n">tests</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">integration_test</span><span class="o">-</span><span class="n">d993c68b431d39df</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="n">it_adds_two</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

   <span class="n">Doc</span><span class="o">-</span><span class="n">tests</span> <span class="n">adder</span>

<span class="n">running</span> <span class="mi">0</span> <span class="n">tests</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Having <code class="language-plaintext highlighter-rouge">common</code> appear in the test results with <code class="language-plaintext highlighter-rouge">running 0 tests</code> displayed for it is not what we wanted. 
We just wanted to share some code with the other integration test files.</p>

<p>To avoid having <code class="language-plaintext highlighter-rouge">common</code> appear in the test output, instead of creating <em>tests/common.rs</em>, we’ll create <em>tests/common/mod.rs</em>. 
This is an alternate naming convention that Rust also understands. 
Naming the file this way tells Rust not to treat the <code class="language-plaintext highlighter-rouge">common</code> module as an integration test file. 
When we move the <code class="language-plaintext highlighter-rouge">setup</code> function code into <em>tests/common/mod.rs</em> and delete the <em>tests/common.rs</em> file, the section in the test output will no longer appear. 
Files in subdirectories of the tests directory don’t get compiled as separate crates or have sections in the test output.</p>

<p>After we’ve created <em>tests/common/mod.rs</em>, we can use it from any of the integration test files as a module. 
Here’s an example of calling the <code class="language-plaintext highlighter-rouge">setup</code> function from the <code class="language-plaintext highlighter-rouge">it_adds_two</code> test in <em>tests/integration_test.rs</em>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//Filename: tests/integration_test.rs</span>
<span class="k">use</span> <span class="n">adder</span><span class="p">;</span>

<span class="k">mod</span> <span class="n">common</span><span class="p">;</span>

<span class="nd">#[test]</span>
<span class="k">fn</span> <span class="nf">it_adds_two</span><span class="p">()</span> <span class="p">{</span>
    <span class="nn">common</span><span class="p">::</span><span class="nf">setup</span><span class="p">();</span>
    <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nn">adder</span><span class="p">::</span><span class="nf">add_two</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Note that the <code class="language-plaintext highlighter-rouge">mod common;</code> declaration is the same as the module declaration we demonstrated in Listing 7-21. 
Then in the test function, we can call the <code class="language-plaintext highlighter-rouge">common::setup()</code> function.</p>

<h3 id="integration-tests-for-binary-crates">Integration Tests for Binary Crates</h3>
<p>If our project is a binary crate that only contains a <em>src/main.rs</em> file and doesn’t have a <em>src/lib.rs</em> file, we can’t create integration tests in the <code class="language-plaintext highlighter-rouge">tests</code> directory and bring functions defined in the <em>src/main.rs</em> file into scope with a <code class="language-plaintext highlighter-rouge">use</code> statement. 
Only library crates expose functions that other crates can use; binary crates are meant to be run on their own.</p>

<p>This is one of the reasons Rust projects that provide a binary have a straightforward <em>src/main.rs</em> file that calls logic that lives in the <em>src/lib.rs</em> file. 
Using that structure, integration tests can test the library crate with <code class="language-plaintext highlighter-rouge">use</code> to make the important functionality available. 
If the important functionality works, the small amount of code in the <em>src/main.rs</em> file will work as well, and that small amount of code doesn’t need to be tested.</p>

<h2 id="summary">Summary</h2>
<p>Rust’s testing features provide a way to specify how code should function to ensure it continues to work as you expect, even as you make changes. 
<strong>Unit tests</strong> exercise different parts of a library separately and can test private implementation details. 
<strong>Integration tests</strong> check that many parts of the library work together correctly, and they use the library’s public API to test the code in the same way external code will use it. 
Even though Rust’s type system and ownership rules help prevent some kinds of bugs, tests are still important to reduce logic bugs having to do with how your code is expected to behave.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#automataion" class="page__taxonomy-item" rel="tag">Automataion</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#bug" class="page__taxonomy-item" rel="tag">Bug</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#test" class="page__taxonomy-item" rel="tag">Test</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#rust-language" class="page__taxonomy-item" rel="tag">RUST Language</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-03-09T00:00:00+00:00">March 9, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=RUST+%3A+11.+Writing+Automated+Tests%20https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F11.Writing-Automated-Tests" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F11.Writing-Automated-Tests" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F11.Writing-Automated-Tests" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/article/ms-creating-a-new-Rust-like-programming-language/" class="pagination--pager" title="Microsoft: We’re creating a new Rust-like programming language for secure coding
">Previous</a>
    
    
      <a href="/rust/12.An-IO-Project-Building-a-Command-Line-Program" class="pagination--pager" title="RUST : 12. An I/O Project: Building a Command Line Program
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/How-to-check-overflow-and-underflow-in-integer-types" rel="permalink">RUST : How to check overflow and underflow in integer types
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">What is overflow and underflow?
Overflow occurs when an arithmetic operation attempts to create a numeric value that is outside of the range that can be repr...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/19.Advanced-Features" rel="permalink">RUST : 19. Advanced Features
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  69 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Advanced Features
By now, you’ve learned the most commonly used parts of the Rust programming language. 
Before we do one more project in Chapter 20, we’ll l...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/18.Patterns-and-Matching" rel="permalink">RUST : 18. Patterns and Matching
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  38 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Patterns and Matching
Patterns are a special syntax in Rust for matching against the structure of types, both complex and simple. 
Using patterns in conjunct...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/17.Object-Oriented-Programming-Features-of-Rust" rel="permalink">RUST : 17. Object Oriented Programming Features of Rust
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  42 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Object Oriented Programming Features of Rust
Object-oriented programming (OOP) is a way of modeling programs. 
Objects came from Simula in the 1960s. 
Those ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
    

    <li><a href="NONE"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JJungs-lee. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
