<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html -->

<!----><title>Yes! I Take IT :)</title>
<meta name="description" content="An I/O Project: Building a Command Line ProgramThis chapter is a recap of the many skills you’ve learned so far and an exploration of a few more standard library features. We’ll build a command line tool that interacts with file and command line input/output to practice some of the Rust concepts you now have under your belt.">


  <meta name="author" content="JJungs-lee">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Yes! I Take IT">
<meta property="og:title" content="RUST : 12. An I/O Project: Building a Command Line Program">
<meta property="og:url" content="https://jjungs-lee.github.io//rust/12.An-IO-Project-Building-a-Command-Line-Program">


  <meta property="og:description" content="An I/O Project: Building a Command Line ProgramThis chapter is a recap of the many skills you’ve learned so far and an exploration of a few more standard library features. We’ll build a command line tool that interacts with file and command line input/output to practice some of the Rust concepts you now have under your belt.">







  <meta property="article:published_time" content="2020-04-02T00:00:00+00:00">





  

  


<link rel="canonical" href="https://jjungs-lee.github.io//rust/12.An-IO-Project-Building-a-Command-Line-Program">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "JJungs-lee",
      "url": "https://jjungs-lee.github.io//"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="NONE" type="application/atom+xml" rel="alternate" title="Yes! I Take IT Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          <b>I.T.I</b> <small>by JHLee</small>
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/kernel/" >Kernel</a>
            </li><li class="masthead__menu-item">
              <a href="/swim/" >Swim</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/author_jhl.png" alt="JJungs-lee" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">JJungs-lee</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Do Coding! Do Study!</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="RUST : 12. An I/O Project: Building a Command Line Program">
    <meta itemprop="description" content="An I/O Project: Building a Command Line ProgramThis chapter is a recap of the many skills you’ve learned so far and an exploration of a few more standard library features. We’ll build a command line tool that interacts with file and command line input/output to practice some of the Rust concepts you now have under your belt.">
    <meta itemprop="datePublished" content="2020-04-02T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">RUST : 12. An I/O Project: Building a Command Line Program
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  49 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="an-io-project-building-a-command-line-program">An I/O Project: Building a Command Line Program</h2>
<p>This chapter is a recap of the many skills you’ve learned so far and an exploration of a few more standard library features. 
We’ll build a <strong>command line tool</strong> that interacts with file and command line input/output to practice some of the Rust concepts you now have under your belt.</p>

<p>Rust’s speed, safety, single binary output, and cross-platform support make it an ideal language for creating command line tools, so for our project, we’ll make our own version of the classic command line tool <code class="language-plaintext highlighter-rouge">grep</code> (<strong>g</strong>lobally search a <strong>r</strong>egular <strong>e</strong>xpression and <strong>p</strong>rint). 
In the simplest use case, <code class="language-plaintext highlighter-rouge">grep</code> searches a specified file for a specified string. 
To do so, <code class="language-plaintext highlighter-rouge">grep</code> takes as its arguments a filename and a string. 
Then it reads the file, finds lines in that file that contain the string argument, and prints those lines.</p>

<p>Along the way, we’ll show how to make our command line tool use features of the terminal that many command line tools use. 
We’ll read the value of an environment variable to allow the user to configure the behavior of our tool. 
We’ll also print error messages to the standard error console stream (<code class="language-plaintext highlighter-rouge">stderr</code>) instead of standard output (<code class="language-plaintext highlighter-rouge">stdout</code>), so, for example, the user can redirect successful output to a file while still seeing error messages onscreen.</p>

<p>One Rust community member, Andrew Gallant, has already created a fully featured, very fast version of <code class="language-plaintext highlighter-rouge">grep</code>, called <code class="language-plaintext highlighter-rouge">ripgrep</code>. 
By comparison, our version of <code class="language-plaintext highlighter-rouge">grep</code> will be fairly simple, but this chapter will give you some of the background knowledge you need to understand a real-world project such as <code class="language-plaintext highlighter-rouge">ripgrep</code>.</p>

<p>Our <code class="language-plaintext highlighter-rouge">grep</code> project will combine a number of concepts you’ve learned so far:</p>

<ul>
  <li>Organizing code (using what you learned about modules in Chapter 7)</li>
  <li>Using vectors and strings (collections, Chapter 8)</li>
  <li>Handling errors (Chapter 9)</li>
  <li>Using traits and lifetimes where appropriate (Chapter 10)</li>
  <li>Writing tests (Chapter 11)
We’ll also briefly introduce closures, iterators, and trait objects, which Chapters <em>13</em> and <em>17</em> will cover in detail.</li>
</ul>

<h2 id="accepting-command-line-arguments">Accepting Command Line Arguments</h2>
<p>Let’s create a new project with, as always, <code class="language-plaintext highlighter-rouge">cargo new</code>. 
We’ll call our project <code class="language-plaintext highlighter-rouge">minigrep</code> to distinguish it from the <code class="language-plaintext highlighter-rouge">grep</code> tool that you might already have on your system.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">new</span> <span class="n">minigrep</span>
     <span class="n">Created</span> <span class="nf">binary</span> <span class="p">(</span><span class="n">application</span><span class="p">)</span> <span class="err">`</span><span class="n">minigrep</span><span class="err">`</span> <span class="n">project</span>
<span class="err">$</span> <span class="n">cd</span> <span class="n">minigrep</span>
</code></pre></div></div>
<p>The first task is to make <code class="language-plaintext highlighter-rouge">minigrep</code> accept its two command line arguments: the filename and a string to search for. 
That is, we want to be able to run our program with <code class="language-plaintext highlighter-rouge">cargo run</code>, a string to search for, and a path to a file to search in, like so:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">searchstring</span> <span class="n">example</span><span class="o">-</span><span class="n">filename</span><span class="py">.txt</span>
</code></pre></div></div>
<p>Right now, the program generated by <code class="language-plaintext highlighter-rouge">cargo new</code> cannot process arguments we give it. 
Some existing libraries on <a href="https://crates.io/">crates.io</a> can help with writing a program that accepts command line arguments, but because you’re just learning this concept, let’s implement this capability ourselves.</p>

<h3 id="reading-the-argument-values">Reading the Argument Values</h3>
<p>To enable <code class="language-plaintext highlighter-rouge">minigrep</code> to read the values of command line arguments we pass to it, we’ll need a function provided in Rust’s standard library, which is <code class="language-plaintext highlighter-rouge">std::env::args</code>. 
This function returns an <code class="language-plaintext highlighter-rouge">iterator</code> of the command line arguments that were given to <code class="language-plaintext highlighter-rouge">minigrep</code>. 
We’ll cover iterators fully in <em>Chapter 13</em>. 
For now, you only need to know two details about iterators: iterators produce a series of values, and we can call the <code class="language-plaintext highlighter-rouge">collect</code> method on an iterator to turn it into a collection, such as a vector, containing all the elements the iterator produces.</p>

<p>Use the code in Listing 12-1 to allow your <code class="language-plaintext highlighter-rouge">minigrep</code> program to read any command line arguments passed to it and then collect the values into a vector.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-1-collecting-the-command-line-arguments-into-a-vector-and-printing-them">Listing 12-1: Collecting the command line arguments into a vector and printing them</h4>

<p>First, we bring the <code class="language-plaintext highlighter-rouge">std::env</code> module into scope with a <code class="language-plaintext highlighter-rouge">use</code> statement so we can use its <code class="language-plaintext highlighter-rouge">args</code> function. 
Notice that the <code class="language-plaintext highlighter-rouge">std::env::args</code> function is nested in two levels of modules. 
As we discussed in Chapter 7, in cases where the desired function is nested in more than one module, it’s conventional to bring the parent module into scope rather than the function. 
By doing so, we can easily use other functions from <code class="language-plaintext highlighter-rouge">std::env</code>. 
It’s also less ambiguous than adding <code class="language-plaintext highlighter-rouge">use std::env::args</code> and then calling the function with just <code class="language-plaintext highlighter-rouge">args</code>, because args <strong>might easily be mistaken for a function that’s defined in the current module</strong>.</p>

<p class="notice--info">The <strong>args</strong> Function and Invalid Unicode<br /><br />
Note that <code class="language-plaintext highlighter-rouge">std::env::args</code> will panic if any argument contains invalid Unicode. 
If your program needs to accept arguments containing invalid Unicode, use <code class="language-plaintext highlighter-rouge">std::env::args_os</code> instead. 
That function returns an iterator that produces <code class="language-plaintext highlighter-rouge">OsString</code> values instead of <code class="language-plaintext highlighter-rouge">String</code> values. 
We’ve chosen to use <code class="language-plaintext highlighter-rouge">std::env::args</code> here for simplicity, because <code class="language-plaintext highlighter-rouge">OsString</code> values differ per platform and are more complex to work with than String values.</p>

<p>On the first line of <code class="language-plaintext highlighter-rouge">main</code>, we call <code class="language-plaintext highlighter-rouge">env::args</code>, and we immediately use <code class="language-plaintext highlighter-rouge">collect</code> to turn the iterator into a vector containing all the values produced by the iterator. 
We can use the <code class="language-plaintext highlighter-rouge">collect</code> function to create many kinds of collections, so we explicitly annotate the type of args to specify that we want a <strong>vector of strings</strong>. 
Although we very rarely need to annotate types in Rust, <code class="language-plaintext highlighter-rouge">collect</code> is one function you do often need to annotate because Rust isn’t able to infer the kind of collection you want.</p>

<p>Finally, we print the vector using the debug formatter, <code class="language-plaintext highlighter-rouge">:?</code>. 
Let’s try running the code first with no arguments and then with two arguments:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span>
<span class="o">--</span><span class="n">snip</span><span class="o">--</span>
<span class="p">[</span><span class="s">"target/debug/minigrep"</span><span class="p">]</span>

<span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">needle</span> <span class="n">haystack</span>
<span class="o">--</span><span class="n">snip</span><span class="o">--</span>
<span class="p">[</span><span class="s">"target/debug/minigrep"</span><span class="p">,</span> <span class="s">"needle"</span><span class="p">,</span> <span class="s">"haystack"</span><span class="p">]</span>
</code></pre></div></div>

<p>Notice that the first value in the vector is <code class="language-plaintext highlighter-rouge">"target/debug/minigrep"</code>, which is the name of our binary. 
This matches the behavior of the arguments list in C, letting programs use the name by which they were invoked in their execution. 
It’s often convenient to have access to the program name in case you want to print it in messages or change behavior of the program based on what command line alias was used to invoke the program. 
But for the purposes of this chapter, we’ll ignore it and save only the two arguments we need.</p>

<h3 id="saving-the-argument-values-in-variables">Saving the Argument Values in Variables</h3>
<p>Printing the value of the vector of arguments illustrated that the program is able to access the values specified as command line arguments. 
Now we need to save the values of the two arguments in variables so we can use the values throughout the rest of the program. We do that in Listing 12-2.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"Searching for {}"</span><span class="p">,</span> <span class="n">query</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"In file {}"</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-2-creating-variables-to-hold-the-query-argument-and-filename-argument">Listing 12-2: Creating variables to hold the query argument and filename argument</h4>

<p>As we saw when we printed the vector, the program’s name takes up the first value in the vector at <code class="language-plaintext highlighter-rouge">args[0]</code>, so we’re starting at index <code class="language-plaintext highlighter-rouge">1</code>. 
The first argument <code class="language-plaintext highlighter-rouge">minigrep</code> takes is the string we’re searching for, so we put a reference to the first argument in the variable <code class="language-plaintext highlighter-rouge">query</code>. 
The second argument will be the filename, so we put a reference to the second argument in the variable <code class="language-plaintext highlighter-rouge">filename</code>.</p>

<p>We temporarily print the values of these variables to prove that the code is working as we intend. 
Let’s run this program again with the arguments <code class="language-plaintext highlighter-rouge">test</code> and <code class="language-plaintext highlighter-rouge">sample.txt</code>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">test</span> <span class="n">sample</span><span class="py">.txt</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">test</span> <span class="n">sample</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">Searching</span> <span class="k">for</span> <span class="n">test</span>
<span class="n">In</span> <span class="n">file</span> <span class="n">sample</span><span class="py">.txt</span>
</code></pre></div></div>

<p>Great, the program is working! The values of the arguments we need are being saved into the right variables. Later we’ll add some error handling to deal with certain potential erroneous situations, such as when the user provides no arguments; for now, we’ll ignore that situation and work on adding file-reading capabilities instead.</p>

<h2 id="reading-a-file">Reading a File</h2>
<p>Now we’ll add functionality to read the file that is specified in the <code class="language-plaintext highlighter-rouge">filename</code> command line argument. 
First, we need a sample file to test it with: the best kind of file to use to make sure <code class="language-plaintext highlighter-rouge">minigrep</code> is working is one with a small amount of text over multiple lines with some repeated words. 
Listing 12-3 has an Emily Dickinson poem that will work well! 
Create a file called <em>poem.txt</em> at the root level of your project, and enter the poem “I’m Nobody! Who are you?”</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: poem.txt</span>
<span class="n">I</span><span class="nv">'m</span> <span class="nd">nobody!</span> <span class="n">Who</span> <span class="n">are</span> <span class="n">you</span><span class="o">?</span>
<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">Then</span> <span class="n">there</span><span class="nv">'s</span> <span class="n">a</span> <span class="n">pair</span> <span class="n">of</span> <span class="n">us</span> <span class="o">-</span> <span class="n">don</span><span class="nv">'t</span> <span class="nd">tell!</span>
<span class="n">They</span><span class="nv">'d</span> <span class="n">banish</span> <span class="n">us</span><span class="p">,</span> <span class="n">you</span> <span class="n">know</span><span class="py">.

How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
<span class="n">How</span> <span class="n">public</span><span class="p">,</span> <span class="n">like</span> <span class="n">a</span> <span class="n">frog</span>
<span class="n">To</span> <span class="n">tell</span> <span class="n">your</span> <span class="n">name</span> <span class="n">the</span> <span class="n">livelong</span> <span class="n">day</span>
<span class="n">To</span> <span class="n">an</span> <span class="n">admiring</span> <span class="nd">bog!</span>
</code></pre></div></div>
<h4 id="listing-12-3-a-poem-by-emily-dickinson-makes-a-good-test-case">Listing 12-3: A poem by Emily Dickinson makes a good test case</h4>

<p>With the text in place, edit <em>src/main.rs</em> and add code to read the file, as shown in Listing 12-4.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Filename</span><span class="p">:</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="py">.rs</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// --snip--</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"In file {}"</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="nf">.expect</span><span class="p">(</span><span class="s">"Something went wrong reading the file"</span><span class="p">);</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"With text:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">,</span> <span class="n">contents</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-4-reading-the-contents-of-the-file-specified-by-the-second-argument">Listing 12-4: Reading the contents of the file specified by the second argument</h4>

<p>First, we add another <code class="language-plaintext highlighter-rouge">use</code> statement to bring in a relevant part of the standard library: we need <code class="language-plaintext highlighter-rouge">std::fs</code> to handle files.</p>

<p>In <code class="language-plaintext highlighter-rouge">main</code>, we’ve added a new statement: <code class="language-plaintext highlighter-rouge">fs::read_to_string</code> takes the <code class="language-plaintext highlighter-rouge">filename</code>, opens that file, and returns a <code class="language-plaintext highlighter-rouge">Result&lt;String&gt;</code> of the file’s contents.</p>

<p>After that statement, we’ve again added a temporary <code class="language-plaintext highlighter-rouge">println!</code> statement that prints the value of <code class="language-plaintext highlighter-rouge">contents</code> after the file is read, so we can check that the program is working so far.</p>

<p>Let’s run this code with any string as the first command line argument (because we haven’t implemented the searching part yet) and the <em>poem.txt</em> file as the second argument:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">the</span> <span class="n">poem</span><span class="py">.txt</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">the</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">Searching</span> <span class="k">for</span> <span class="n">the</span>
<span class="n">In</span> <span class="n">file</span> <span class="n">poem</span><span class="py">.txt</span>
<span class="n">With</span> <span class="n">text</span><span class="p">:</span>
<span class="n">I</span><span class="nv">'m</span> <span class="nd">nobody!</span> <span class="n">Who</span> <span class="n">are</span> <span class="n">you</span><span class="o">?</span>
<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">Then</span> <span class="n">there</span><span class="nv">'s</span> <span class="n">a</span> <span class="n">pair</span> <span class="n">of</span> <span class="n">us</span> — <span class="n">don</span><span class="nv">'t</span> <span class="nd">tell!</span>
<span class="n">They</span><span class="nv">'d</span> <span class="n">banish</span> <span class="n">us</span><span class="p">,</span> <span class="n">you</span> <span class="n">know</span><span class="py">.

How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
<span class="n">How</span> <span class="n">public</span><span class="p">,</span> <span class="n">like</span> <span class="n">a</span> <span class="n">frog</span>
<span class="n">To</span> <span class="n">tell</span> <span class="n">your</span> <span class="n">name</span> <span class="n">the</span> <span class="n">livelong</span> <span class="n">day</span>
<span class="n">To</span> <span class="n">an</span> <span class="n">admiring</span> <span class="nd">bog!</span>
</code></pre></div></div>

<p>Great! The code read and then printed the contents of the file. 
But the code has a few flaws. 
The <code class="language-plaintext highlighter-rouge">main</code> function has multiple responsibilities: generally, functions are clearer and easier to maintain if each function is responsible for only one idea. 
The other problem is that we’re not handling errors as well as we could. 
The program is still small, so these flaws aren’t a big problem, but as the program grows, it will be harder to fix them cleanly. 
It’s good practice to begin refactoring early on when developing a program, because it’s much easier to refactor smaller amounts of code. We’ll do that next.</p>

<h2 id="refactoring-to-improve-modularity-and-error-handling">Refactoring to Improve Modularity and Error Handling</h2>
<p>To improve our program, we’ll fix four problems that have to do with the program’s structure and how it’s handling potential errors.</p>

<p>First, our <code class="language-plaintext highlighter-rouge">main</code> function now performs two tasks: it parses arguments and reads files. 
For such a small function, this isn’t a major problem. 
However, if we continue to grow our program inside <code class="language-plaintext highlighter-rouge">main</code>, the number of separate tasks the <code class="language-plaintext highlighter-rouge">main</code> function handles will increase. 
As a function gains responsibilities, it becomes more difficult to reason about, harder to test, and harder to change without breaking one of its parts. 
It’s best to separate functionality so each function is responsible for one task.</p>

<p>This issue also ties into the second problem: although <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> are configuration variables to our program, variables like contents are used to perform the program’s logic. 
The longer <code class="language-plaintext highlighter-rouge">main</code> becomes, the <strong>more</strong> variables we’ll need to bring into scope; the more variables we have in scope, the harder it will be to keep track of the purpose of each. 
It’s best to group the configuration variables into one structure to make their purpose clear.</p>

<p>The third problem is that we’ve used <code class="language-plaintext highlighter-rouge">expect</code> to print an error message when reading the file fails, but the error message just prints <code class="language-plaintext highlighter-rouge">Something went wrong reading the file</code>. 
Reading a file can fail in a number of ways: for example, the file could be <em>missing</em>, or we might <em>not have permission</em> to open it. 
Right now, regardless of the situation, we’d print the <code class="language-plaintext highlighter-rouge">Something went wrong reading the file</code> error message, which wouldn’t give the user any information!</p>

<p>Fourth, we use <code class="language-plaintext highlighter-rouge">expect</code> repeatedly to handle different errors, and if the user runs our program without specifying enough arguments, they’ll get an index out of bounds error from Rust that doesn’t clearly explain the problem. 
It would be best if all the error-handling code were in one place so future maintainers had only one place to consult in the code if the error-handling logic needed to change. Having all the error-handling code in one place will also ensure that we’re printing messages that will be meaningful to our end users.</p>

<p>Let’s address these four problems by refactoring our project.</p>

<h3 id="separation-of-concerns-for-binary-projects">Separation of Concerns for Binary Projects</h3>
<p>The organizational problem of allocating responsibility for multiple tasks to the <code class="language-plaintext highlighter-rouge">main</code> function is common to many binary projects. 
As a result, the Rust community has developed a process to use as a guideline for splitting the separate concerns of a binary program when <code class="language-plaintext highlighter-rouge">main</code> starts getting large. The process has the following steps:</p>

<ul>
  <li>Split your program into a <code class="language-plaintext highlighter-rouge">main.rs</code> and a <code class="language-plaintext highlighter-rouge">lib.rs</code> and move your program’s logic to <code class="language-plaintext highlighter-rouge">lib.rs</code>.</li>
  <li>As long as your command line parsing logic is small, it can remain in <code class="language-plaintext highlighter-rouge">main.rs</code>.</li>
  <li>When the command line parsing logic starts getting complicated, extract it from <code class="language-plaintext highlighter-rouge">main.rs</code> and move it to <code class="language-plaintext highlighter-rouge">lib.rs</code>.</li>
</ul>

<p>The responsibilities that remain in the <code class="language-plaintext highlighter-rouge">main</code> function after this process should be limited to the following:</p>

<ul>
  <li>Calling the command line parsing logic with the argument values</li>
  <li>Setting up any other configuration</li>
  <li>Calling a <code class="language-plaintext highlighter-rouge">run</code> function in <em>lib.rs</em></li>
  <li>Handling the error if <code class="language-plaintext highlighter-rouge">run</code> returns an error</li>
</ul>

<p>This pattern is about separating concerns: <code class="language-plaintext highlighter-rouge">main.rs</code> handles running the program, and <code class="language-plaintext highlighter-rouge">lib.rs</code> handles all the logic of the task at hand. 
Because you can’t test the <code class="language-plaintext highlighter-rouge">main</code> function directly, this structure lets you test all of your program’s logic by moving it into functions in <em>lib.rs</em>. 
The only code that remains in <em>main.rs</em> will be small enough to verify its correctness by reading it. 
Let’s rework our program by following this process.</p>

<h3 id="extracting-the-argument-parser">Extracting the Argument Parser</h3>
<p>We’ll extract the functionality for parsing arguments into a function that <code class="language-plaintext highlighter-rouge">main</code> will call to prepare for moving the command line parsing logic to <em>src/lib.rs</em>. 
Listing 12-5 shows the new start of <code class="language-plaintext highlighter-rouge">main</code> that calls a new function <code class="language-plaintext highlighter-rouge">parse_config</code>, which we’ll define in <em>src/main.rs</em> for the moment.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span> <span class="o">=</span> <span class="nf">parse_config</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">);</span>

    <span class="c1">// --snip--</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

    <span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-5-extracting-a-parse_config-function-from-main">Listing 12-5: Extracting a parse_config function from main</h4>
<p>We’re still collecting the command line arguments into a vector, but instead of assigning the argument value at index 1 to the variable <code class="language-plaintext highlighter-rouge">query</code> and the argument value at index 2 to the variable <code class="language-plaintext highlighter-rouge">filename</code> within the <code class="language-plaintext highlighter-rouge">main</code> function, we pass the whole vector to the <code class="language-plaintext highlighter-rouge">parse_config</code> function. 
The <code class="language-plaintext highlighter-rouge">parse_config</code> function then holds the logic that determines which argument goes in which variable and passes the values back to <code class="language-plaintext highlighter-rouge">main</code>. 
We still create the <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> variables in main, but <code class="language-plaintext highlighter-rouge">main</code> no longer has the responsibility of determining how the command line arguments and variables correspond.</p>

<p>This rework may seem like overkill for our small program, but we’re refactoring in small, incremental steps. 
After making this change, run the program again to verify that the argument parsing still works. 
It’s good to check your progress often, to help identify the cause of problems when they occur.</p>

<h3 id="grouping-configuration-values">Grouping Configuration Values</h3>
<p>We can take another small step to improve the parse_config function further. 
At the moment, we’re returning a tuple, but then we immediately break that tuple into individual parts again. 
This is a sign that perhaps we don’t have the right abstraction yet.</p>

<p>Another indicator that shows there’s room for improvement is the <code class="language-plaintext highlighter-rouge">config</code> part of <code class="language-plaintext highlighter-rouge">parse_config</code>, which implies that the two values we return are related and are both part of one configuration value. 
We’re not currently conveying this meaning in the structure of the data other than by grouping the two values into a tuple; we could put the two values into one struct and give each of the struct fields a meaningful name. Doing so will make it easier for future maintainers of this code to understand how the different values relate to each other and what their purpose is.</p>

<p class="notice--info">Note: Using primitive values when a complex type would be more appropriate is an anti-pattern known as primitive obsession.</p>

<p>Listing 12-6 shows the improvements to the parse_config function.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">config</span> <span class="o">=</span> <span class="nf">parse_config</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">);</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"Searching for {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.query</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"In file {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.filename</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">config</span><span class="py">.filename</span><span class="p">)</span>
        <span class="nf">.expect</span><span class="p">(</span><span class="s">"Something went wrong reading the file"</span><span class="p">);</span>

    <span class="c1">// --snip--</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">parse_config</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>

    <span class="n">Config</span> <span class="p">{</span> <span class="n">query</span><span class="p">,</span> <span class="n">filename</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-6-refactoring-parse_config-to-return-an-instance-of-a-config-struct">Listing 12-6: Refactoring parse_config to return an instance of a Config struct</h4>

<p>We’ve added a struct named <code class="language-plaintext highlighter-rouge">Config</code> defined to have fields named <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code>. 
The signature of <code class="language-plaintext highlighter-rouge">parse_config</code> now indicates that it returns a <code class="language-plaintext highlighter-rouge">Config</code> value. 
In the body of <code class="language-plaintext highlighter-rouge">parse_config</code>, where we used to return string slices that reference <code class="language-plaintext highlighter-rouge">String</code> values in <code class="language-plaintext highlighter-rouge">args</code>, we now define <code class="language-plaintext highlighter-rouge">Config</code> to contain owned <code class="language-plaintext highlighter-rouge">String</code> values. 
The <code class="language-plaintext highlighter-rouge">args</code> variable in <code class="language-plaintext highlighter-rouge">main</code> is the owner of the argument values and is only letting the <code class="language-plaintext highlighter-rouge">parse_config</code> function borrow them, which means we’d violate Rust’s borrowing rules if <code class="language-plaintext highlighter-rouge">Config</code> tried to take ownership of the values in <code class="language-plaintext highlighter-rouge">args</code>.</p>

<p>We could manage the <code class="language-plaintext highlighter-rouge">String</code> data in a number of different ways, but the easiest, though somewhat inefficient, route is to call the <code class="language-plaintext highlighter-rouge">clone</code> method on the values. 
This will make a full copy of the data for the <code class="language-plaintext highlighter-rouge">Config</code> instance to own, which takes more time and memory than storing a reference to the string data. 
However, cloning the data also makes our code very straightforward because we don’t have to manage the lifetimes of the references; in this circumstance, giving up a little performance to gain simplicity is a worthwhile trade-off.</p>

<p class="notice--info"><strong>The Trade-Offs of Using clone</strong><br />
There’s a tendency among many Rustaceans to avoid using <code class="language-plaintext highlighter-rouge">clone</code> to fix ownership problems because of its runtime cost. 
In Chapter 13, you’ll learn how to use more efficient methods in this type of situation. 
But for now, it’s okay to copy a few strings to continue making progress because you’ll make these copies only once and your filename and query string are very small. 
It’s better to have a working program that’s a bit inefficient than to try to hyperoptimize code on your first pass. 
As you become more experienced with Rust, it’ll be easier to start with the most efficient solution, but for now, it’s perfectly acceptable to call <code class="language-plaintext highlighter-rouge">clone</code>.</p>

<p>We’ve updated <code class="language-plaintext highlighter-rouge">main</code> so it places the instance of <code class="language-plaintext highlighter-rouge">Config</code> returned by <code class="language-plaintext highlighter-rouge">parse_config</code> into a variable named <code class="language-plaintext highlighter-rouge">config</code>, and we updated the code that previously used the separate <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> variables so it now uses the fields on the <code class="language-plaintext highlighter-rouge">Config</code> struct instead.</p>

<p>Now our code more clearly conveys that <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> are related and that their purpose is to configure how the program will work. 
Any code that uses these values knows to find them in the <code class="language-plaintext highlighter-rouge">config</code> instance in the fields named for their purpose.</p>

<h3 id="creating-a-constructor-for-config">Creating a Constructor for Config</h3>
<p>So far, we’ve extracted the logic responsible for parsing the command line arguments from <code class="language-plaintext highlighter-rouge">main</code> and placed it in the <code class="language-plaintext highlighter-rouge">parse_config</code> function. 
Doing so helped us to see that the <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> values were related and that relationship should be conveyed in our code. We then added a <code class="language-plaintext highlighter-rouge">Config</code> struct to name the related purpose of <code class="language-plaintext highlighter-rouge">query</code> and <code class="language-plaintext highlighter-rouge">filename</code> and to be able to return the values’ names as struct field names from the <code class="language-plaintext highlighter-rouge">parse_config</code> function.</p>

<p>So now that the purpose of the <code class="language-plaintext highlighter-rouge">parse_config</code> function is to create a <code class="language-plaintext highlighter-rouge">Config</code> instance, we can change <code class="language-plaintext highlighter-rouge">parse_config</code> from a plain function to a function named <code class="language-plaintext highlighter-rouge">new</code> that is associated with the <code class="language-plaintext highlighter-rouge">Config</code> struct. 
Making this change will make the code more idiomatic. 
We can create instances of types in the standard library, such as <code class="language-plaintext highlighter-rouge">String</code>, by calling <code class="language-plaintext highlighter-rouge">String::new</code>. 
Similarly, by changing <code class="language-plaintext highlighter-rouge">parse_config</code> into a <code class="language-plaintext highlighter-rouge">new</code> function associated with <code class="language-plaintext highlighter-rouge">Config</code>, we’ll be able to create instances of <code class="language-plaintext highlighter-rouge">Config</code> by calling <code class="language-plaintext highlighter-rouge">Config::new</code>. Listing 12-7 shows the changes we need to make.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Filename</span><span class="p">:</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="py">.rs</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">config</span> <span class="o">=</span> <span class="nn">Config</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">);</span>

    <span class="c1">// --snip--</span>
<span class="p">}</span>

<span class="c1">// --snip--</span>

<span class="k">impl</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="n">Config</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>

        <span class="n">Config</span> <span class="p">{</span> <span class="n">query</span><span class="p">,</span> <span class="n">filename</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-7-changing-parse_config-into-confignew">Listing 12-7: Changing parse_config into Config::new</h4>
<p>We’ve updated <code class="language-plaintext highlighter-rouge">main</code> where we were calling <code class="language-plaintext highlighter-rouge">parse_config</code> to instead call <code class="language-plaintext highlighter-rouge">Config::new</code>. 
We’ve changed the name of <code class="language-plaintext highlighter-rouge">parse_config</code> to <code class="language-plaintext highlighter-rouge">new</code> and moved it within an <code class="language-plaintext highlighter-rouge">impl</code> block, which associates the new function with <code class="language-plaintext highlighter-rouge">Config</code>. Try compiling this code again to make sure it works.</p>

<h3 id="fixing-the-error-handling">Fixing the Error Handling</h3>
<p>Now we’ll work on fixing our error handling. 
Recall that attempting to access the values in the <code class="language-plaintext highlighter-rouge">args</code> vector at index 1 or index 2 will cause the program to panic if the vector contains fewer than three items. 
Try running the program without any arguments; it will look like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span><span class="err">`</span>
<span class="n">thread</span> <span class="nv">'main</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'index</span> <span class="n">out</span> <span class="n">of</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">the</span> <span class="n">len</span> <span class="n">is</span> <span class="mi">1</span>
<span class="n">but</span> <span class="n">the</span> <span class="n">index</span> <span class="n">is</span> <span class="mi">1</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="py">.rs</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">21</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="err">.</span>
</code></pre></div></div>
<p>The line <code class="language-plaintext highlighter-rouge">index out of bounds: the len is 1 but the index is 1</code> is an error message intended for programmers. It won’t help our end users understand what happened and what they should do instead. Let’s fix that now.</p>

<h3 id="improving-the-error-message">Improving the Error Message</h3>
<p>In Listing 12-8, we add a check in the <code class="language-plaintext highlighter-rouge">new</code> function that will verify that the slice is long enough before accessing index 1 and 2. 
If the slice isn’t long enough, the program panics and displays a better error message than the <code class="language-plaintext highlighter-rouge">index out of bounds</code> message.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="c1">// --snip--</span>
<span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">args</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
        <span class="nd">panic!</span><span class="p">(</span><span class="s">"not enough arguments"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// --snip--</span>
</code></pre></div></div>
<h4 id="listing-12-8-adding-a-check-for-the-number-of-arguments">Listing 12-8: Adding a check for the number of arguments</h4>

<p>This code is similar to the <code class="language-plaintext highlighter-rouge">Guess::new</code> function we wrote in Listing 9-10, where we called <code class="language-plaintext highlighter-rouge">panic!</code> when the value argument was out of the range of valid values. 
Instead of checking for a range of values here, we’re checking that the length of <code class="language-plaintext highlighter-rouge">args</code> is at least 3 and the rest of the function can operate under the assumption that this condition has been met. 
If <code class="language-plaintext highlighter-rouge">args</code> has fewer than three items, this condition will be true, and we call the <code class="language-plaintext highlighter-rouge">panic!</code> macro to end the program immediately.</p>

<p>With these extra few lines of code in <code class="language-plaintext highlighter-rouge">new</code>, let’s run the program without any arguments again to see what the error looks like now:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span><span class="err">`</span>
<span class="n">thread</span> <span class="nv">'main</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'not</span> <span class="n">enough</span> <span class="n">arguments</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="py">.rs</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">13</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="err">.</span>
</code></pre></div></div>

<p>This output is better: we now have a reasonable error message. 
However, we also have extraneous information we don’t want to give to our users. 
Perhaps using the technique we used in Listing 9-10 isn’t the best to use here: a call to <code class="language-plaintext highlighter-rouge">panic!</code> is more appropriate for a programming problem than a usage problem, as <a href="9.Error-Handling#guidelines-for-error-handling">discussed in Chapter 9</a>. 
Instead, we can use the other technique you learned about in Chapter 9—<a href="9.Error-Handling#recoverable-errors-with-result">returning a Result</a> that indicates either success or an error.</p>

<h3 id="returning-a-result-from-new-instead-of-calling-panic">Returning a Result from new Instead of Calling panic!</h3>
<p>We can instead return a <code class="language-plaintext highlighter-rouge">Result</code> value that will contain a <code class="language-plaintext highlighter-rouge">Config</code> instance in the successful case and will describe the problem in the error case. 
When <code class="language-plaintext highlighter-rouge">Config::new</code> is communicating to <code class="language-plaintext highlighter-rouge">main</code>, we can use the <code class="language-plaintext highlighter-rouge">Result</code> type to signal there was a problem. 
Then we can change <code class="language-plaintext highlighter-rouge">main</code> to convert an <code class="language-plaintext highlighter-rouge">Err</code> variant into a more practical error for our users without the surrounding text about <code class="language-plaintext highlighter-rouge">thread 'main'</code> and <code class="language-plaintext highlighter-rouge">RUST_BACKTRACE</code> that a call to <code class="language-plaintext highlighter-rouge">panic!</code> causes.</p>

<p>Listing 12-9 shows the changes we need to make to the return value of <code class="language-plaintext highlighter-rouge">Config::new</code> and the body of the function needed to return a <code class="language-plaintext highlighter-rouge">Result</code>. 
Note that this won’t compile until we update <code class="language-plaintext highlighter-rouge">main</code> as well, which we’ll do in the next listing.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="k">impl</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Config</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">args</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"not enough arguments"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">Config</span> <span class="p">{</span> <span class="n">query</span><span class="p">,</span> <span class="n">filename</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-9-returning-a-result-from-confignew">Listing 12-9: Returning a Result from Config::new</h4>

<p>Our <code class="language-plaintext highlighter-rouge">new</code> function now returns a <code class="language-plaintext highlighter-rouge">Result</code> with a <code class="language-plaintext highlighter-rouge">Config</code> instance in the success case and a <code class="language-plaintext highlighter-rouge">&amp;'static str</code> in the error case. 
Recall from <a href="10.Generic-Types,-Traits,-and-Lifetimes#the-static-lifetime">“The Static Lifetime”</a> section in Chapter 10 that <code class="language-plaintext highlighter-rouge">&amp;'static str</code> is the type of string literals, which is our error message type for now.</p>

<p>We’ve made two changes in the body of the <code class="language-plaintext highlighter-rouge">new</code> function: instead of calling <code class="language-plaintext highlighter-rouge">panic!</code> when the user doesn’t pass enough arguments, we now return an <code class="language-plaintext highlighter-rouge">Err</code> value, and we’ve wrapped the <code class="language-plaintext highlighter-rouge">Config</code> return value in an <code class="language-plaintext highlighter-rouge">Ok</code>. 
These changes make the function conform to its new type signature.</p>

<p>Returning an <code class="language-plaintext highlighter-rouge">Err</code> value from <code class="language-plaintext highlighter-rouge">Config::new</code> allows the <code class="language-plaintext highlighter-rouge">main</code> function to handle the <code class="language-plaintext highlighter-rouge">Result</code> value returned from the <code class="language-plaintext highlighter-rouge">new</code> function and exit the process more cleanly in the error case.</p>

<h3 id="calling-confignew-and-handling-errors">Calling Config::new and Handling Errors</h3>
<p>To handle the error case and print a user-friendly message, we need to update <code class="language-plaintext highlighter-rouge">main</code> to handle the <code class="language-plaintext highlighter-rouge">Result</code> being returned by <code class="language-plaintext highlighter-rouge">Config::new</code>, as shown in Listing 12-10. 
We’ll also take the responsibility of exiting the command line tool with a nonzero error code from <code class="language-plaintext highlighter-rouge">panic!</code> and implement it by hand. A nonzero exit status is a convention to signal to the process that called our program that the program exited with an error state.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">process</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">config</span> <span class="o">=</span> <span class="nn">Config</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">err</span><span class="p">|</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Problem parsing arguments: {}"</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
        <span class="nn">process</span><span class="p">::</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// --snip--</span>
</code></pre></div></div>
<h4 id="listing-12-10-exiting-with-an-error-code-if-creating-a-new-config-fails">Listing 12-10: Exiting with an error code if creating a new Config fails</h4>

<p>In this listing, we’ve used a method we haven’t covered before: <code class="language-plaintext highlighter-rouge">unwrap_or_else</code>, which is defined on <code class="language-plaintext highlighter-rouge">Result&lt;T, E&gt;</code> by the standard library. 
Using <code class="language-plaintext highlighter-rouge">unwrap_or_else</code> allows us to define some custom, non-<code class="language-plaintext highlighter-rouge">panic!</code> error handling. 
If the <code class="language-plaintext highlighter-rouge">Result</code> is an <code class="language-plaintext highlighter-rouge">Ok</code> value, this method’s behavior is similar to <code class="language-plaintext highlighter-rouge">unwrap</code>: it returns the inner value <code class="language-plaintext highlighter-rouge">Ok</code> is wrapping. 
However, if the value is an <code class="language-plaintext highlighter-rouge">Err</code> value, this method calls the code in the closure, which is an anonymous function we define and pass as an argument to <code class="language-plaintext highlighter-rouge">unwrap_or_else</code>. 
We’ll cover closures in more detail in Chapter 13. 
For now, you just need to know that <code class="language-plaintext highlighter-rouge">unwrap_or_else</code> will pass the inner value of the <code class="language-plaintext highlighter-rouge">Err</code>, which in this case is the static string <code class="language-plaintext highlighter-rouge">not enough arguments</code> that we added in Listing 12-9, to our closure in the argument <code class="language-plaintext highlighter-rouge">err</code> that appears between the vertical pipes. 
The code in the closure can then use the <code class="language-plaintext highlighter-rouge">err</code> value when it runs.</p>

<p>We’ve added a new <code class="language-plaintext highlighter-rouge">use</code> line to bring <code class="language-plaintext highlighter-rouge">process</code> from the standard library into scope. 
The code in the closure that will be run in the error case is only two lines: we print the <code class="language-plaintext highlighter-rouge">err</code> value and then call <code class="language-plaintext highlighter-rouge">process::exit</code>. 
The <code class="language-plaintext highlighter-rouge">process::exit</code> function will stop the program immediately and return the number that was passed as the exit status code. 
This is similar to the <code class="language-plaintext highlighter-rouge">panic!</code>-based handling we used in Listing 12-8, but we no longer get all the extra output. Let’s try it:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.48</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span><span class="err">`</span>
<span class="n">Problem</span> <span class="n">parsing</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">not</span> <span class="n">enough</span> <span class="n">arguments</span>
</code></pre></div></div>
<p>Great! This output is much friendlier for our users.</p>

<h3 id="extracting-logic-from-main">Extracting Logic from main</h3>
<p>Now that we’ve finished refactoring the configuration parsing, let’s turn to the program’s logic. 
As we stated in <a href="12.An-IO-Project-Building-a-Command-Line-Program#separation-of-concerns-for-binary-projects">“Separation of Concerns for Binary Projects”</a>, we’ll extract a function named <code class="language-plaintext highlighter-rouge">run</code> that will hold all the logic currently in the <code class="language-plaintext highlighter-rouge">main</code> function that isn’t involved with setting up configuration or handling errors. 
When we’re done, <code class="language-plaintext highlighter-rouge">main</code> will be concise and easy to verify by inspection, and we’ll be able to write tests for all the other logic.</p>

<p>Listing 12-11 shows the extracted <code class="language-plaintext highlighter-rouge">run</code> function. For now, we’re just making the small, incremental improvement of extracting the function. We’re still defining the function in src/main.rs.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// --snip--</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"Searching for {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.query</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"In file {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.filename</span><span class="p">);</span>

    <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">config</span><span class="py">.filename</span><span class="p">)</span>
        <span class="nf">.expect</span><span class="p">(</span><span class="s">"Something went wrong reading the file"</span><span class="p">);</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"With text:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">,</span> <span class="n">contents</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// --snip--</span>
</code></pre></div></div>
<h4 id="listing-12-11-extracting-a-run-function-containing-the-rest-of-the-program-logic">Listing 12-11: Extracting a run function containing the rest of the program logic</h4>

<p>The <code class="language-plaintext highlighter-rouge">run</code> function now contains all the remaining logic from <code class="language-plaintext highlighter-rouge">main</code>, starting from reading the file. 
The <code class="language-plaintext highlighter-rouge">run</code> function takes the <code class="language-plaintext highlighter-rouge">Config</code> instance as an argument.</p>

<h3 id="returning-errors-from-the-run-function">Returning Errors from the run Function</h3>
<p>With the remaining program logic separated into the <code class="language-plaintext highlighter-rouge">run</code> function, we can improve the error handling, as we did with <code class="language-plaintext highlighter-rouge">Config::new</code> in Listing 12-9. 
Instead of allowing the program to panic by calling <code class="language-plaintext highlighter-rouge">expect</code>, the <code class="language-plaintext highlighter-rouge">run</code> function will return a <code class="language-plaintext highlighter-rouge">Result&lt;T, E&gt;</code> when something goes wrong. 
This will let us further consolidate into <code class="language-plaintext highlighter-rouge">main</code> the logic around handling errors in a user-friendly way. Listing 12-12 shows the changes we need to make to the signature and body of <code class="language-plaintext highlighter-rouge">run</code>.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="p">;</span>

<span class="c1">// --snip--</span>

<span class="k">fn</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">config</span><span class="py">.filename</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"With text:</span><span class="se">\n</span><span class="s">{}"</span><span class="p">,</span> <span class="n">contents</span><span class="p">);</span>

    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-12-changing-the-run-function-to-return-result">Listing 12-12: Changing the run function to return Result</h4>

<p>We’ve made three significant changes here. 
First, we changed the return type of the <code class="language-plaintext highlighter-rouge">run</code> function to <code class="language-plaintext highlighter-rouge">Result&lt;(), Box&lt;dyn Error&gt;&gt;</code>. 
This function previously returned the unit type, <code class="language-plaintext highlighter-rouge">()</code>, and we keep that as the value returned in the <code class="language-plaintext highlighter-rouge">Ok</code> case.</p>

<p>For the error type, we used the trait object <code class="language-plaintext highlighter-rouge">Box&lt;dyn Error&gt;</code> (and we’ve brought <code class="language-plaintext highlighter-rouge">std::error::Error</code> into scope with a use statement at the top). We’ll cover trait objects in Chapter 17. 
For now, just know that <code class="language-plaintext highlighter-rouge">Box&lt;dyn Error&gt;</code> means the function will return a type that implements the <code class="language-plaintext highlighter-rouge">Error</code> trait, but we don’t have to specify what particular type the return value will be. 
This gives us flexibility to return error values that may be of different types in different error cases. 
The <code class="language-plaintext highlighter-rouge">dyn</code> keyword is short for “dynamic.”</p>

<p>Second, we’ve removed the call to <code class="language-plaintext highlighter-rouge">expect</code> in favor of the <code class="language-plaintext highlighter-rouge">?</code> operator, as we talked about in Chapter 9. 
Rather than <code class="language-plaintext highlighter-rouge">panic!</code> on an error, <code class="language-plaintext highlighter-rouge">?</code> will return the error value from the current function for the caller to handle.</p>

<p>Third, the <code class="language-plaintext highlighter-rouge">run</code> function now returns an <code class="language-plaintext highlighter-rouge">Ok</code> value in the success case. 
We’ve declared the <code class="language-plaintext highlighter-rouge">run</code> function’s success type as <code class="language-plaintext highlighter-rouge">()</code> in the signature, which means we need to wrap the unit type value in the <code class="language-plaintext highlighter-rouge">Ok</code> value. 
This <code class="language-plaintext highlighter-rouge">Ok(())</code> syntax might look a bit strange at first, but using <code class="language-plaintext highlighter-rouge">()</code> like this is the idiomatic way to indicate that we’re calling <code class="language-plaintext highlighter-rouge">run</code> for its side effects only; it doesn’t return a value we need.</p>

<p>When you run this code, it will compile but will display a warning:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">warning</span><span class="p">:</span> <span class="n">unused</span> <span class="err">`</span><span class="nn">std</span><span class="p">::</span><span class="nn">result</span><span class="p">::</span><span class="nb">Result</span><span class="err">`</span> <span class="n">that</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span>
  <span class="o">-</span><span class="k">-&gt;</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="py">.rs</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">5</span>
   <span class="p">|</span>
<span class="mi">17</span> <span class="p">|</span>     <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
   <span class="p">|</span>     <span class="o">^^^^^^^^^^^^</span>
   <span class="p">|</span>
   <span class="o">=</span> <span class="n">note</span><span class="p">:</span> <span class="nd">#[warn(unused_must_use)]</span> <span class="n">on</span> <span class="n">by</span> <span class="n">default</span>
   <span class="o">=</span> <span class="n">note</span><span class="p">:</span> <span class="n">this</span> <span class="err">`</span><span class="nb">Result</span><span class="err">`</span> <span class="n">may</span> <span class="n">be</span> <span class="n">an</span> <span class="err">`</span><span class="nb">Err</span><span class="err">`</span> <span class="n">variant</span><span class="p">,</span> <span class="n">which</span> <span class="n">should</span> <span class="n">be</span> <span class="n">handled</span>
</code></pre></div></div>
<p>Rust tells us that our code ignored the <code class="language-plaintext highlighter-rouge">Result</code> value and the Result value might indicate that an error occurred. 
But we’re not checking to see whether or not there was an error, and the compiler reminds us that we probably meant to have some error-handling code here! Let’s rectify that problem now.</p>

<h3 id="handling-errors-returned-from-run-in-main">Handling Errors Returned from run in main</h3>
<p>We’ll check for errors and handle them using a technique similar to one we used with <code class="language-plaintext highlighter-rouge">Config::new</code> in Listing 12-10, but with a slight difference:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// --snip--</span>

    <span class="nd">println!</span><span class="p">(</span><span class="s">"Searching for {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.query</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"In file {}"</span><span class="p">,</span> <span class="n">config</span><span class="py">.filename</span><span class="p">);</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Application error: {}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>

        <span class="nn">process</span><span class="p">::</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We use <code class="language-plaintext highlighter-rouge">if let</code> rather than <code class="language-plaintext highlighter-rouge">unwrap_or_else</code> to check whether <code class="language-plaintext highlighter-rouge">run</code> returns an <code class="language-plaintext highlighter-rouge">Err</code> value and call <code class="language-plaintext highlighter-rouge">process::exit(1)</code> if it does. 
The <code class="language-plaintext highlighter-rouge">run</code> function doesn’t return a value that we want to <code class="language-plaintext highlighter-rouge">unwrap</code> in the same way that <code class="language-plaintext highlighter-rouge">Config::new</code> returns the Config instance. 
Because <code class="language-plaintext highlighter-rouge">run</code> returns <code class="language-plaintext highlighter-rouge">()</code> in the success case, we only care about detecting an error, so we don’t need <code class="language-plaintext highlighter-rouge">unwrap_or_else</code> to return the unwrapped value because it would only be <code class="language-plaintext highlighter-rouge">()</code>.</p>

<p>The bodies of the <code class="language-plaintext highlighter-rouge">if let</code> and the <code class="language-plaintext highlighter-rouge">unwrap_or_else</code> functions are the same in both cases: we print the error and exit.</p>

<h2 id="splitting-code-into-a-library-crate">Splitting Code into a Library Crate</h2>
<p>Our <code class="language-plaintext highlighter-rouge">minigrep</code> project is looking good so far! Now we’ll split the <em>src/main.rs</em> file and put some code into the <em>src/lib.rs</em> file so we can test it and have a <em>src/main.rs</em> file with fewer responsibilities.</p>

<p>Let’s move all the code that isn’t the main function from <em>src/main.rs</em> to <em>src/lib.rs</em>:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">run</code> function definition</li>
  <li>The relevant <code class="language-plaintext highlighter-rouge">use</code> statements</li>
  <li>The definition of <code class="language-plaintext highlighter-rouge">Config</code></li>
  <li>The <code class="language-plaintext highlighter-rouge">Config::new</code> function definition</li>
</ul>

<p>The contents of <em>src/lib.rs</em> should have the signatures shown in Listing 12-13 (we’ve omitted the bodies of the functions for brevity). Note that this won’t compile until we modify <em>src/main.rs</em> in Listing 12-14.</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>

<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">fs</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">query</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Config</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// --snip--</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="c1">// --snip--</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-13-moving-config-and-run-into-srclibrs">Listing 12-13: Moving Config and run into src/lib.rs</h4>

<p>We’ve made liberal use of the <code class="language-plaintext highlighter-rouge">pub</code> keyword: on <code class="language-plaintext highlighter-rouge">Config</code>, on its fields and its <code class="language-plaintext highlighter-rouge">new</code> method, and on the <code class="language-plaintext highlighter-rouge">run</code> function. 
We now have a library crate that has a public API that we can test!</p>

<p>Now we need to bring the code we moved to <em>src/lib.rs</em> into the scope of the binary crate in <em>src/main.rs</em>, as shown in Listing 12-14.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">process</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">minigrep</span><span class="p">::</span><span class="n">Config</span><span class="p">;</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// --snip--</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="nn">minigrep</span><span class="p">::</span><span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// --snip--</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-14-using-the-minigrep-library-crate-in-srcmainrs">Listing 12-14: Using the minigrep library crate in src/main.rs</h4>

<p>We add a <code class="language-plaintext highlighter-rouge">use minigrep::Config</code> line to bring the <code class="language-plaintext highlighter-rouge">Config</code> type from the library crate into the binary crate’s scope, and we prefix the <code class="language-plaintext highlighter-rouge">run</code> function with our crate name. 
Now all the functionality should be connected and should work. 
Run the program with <code class="language-plaintext highlighter-rouge">cargo run</code> and make sure everything works correctly.</p>

<p>Whew! That was a lot of work, but we’ve set ourselves up for success in the future. 
Now it’s much easier to handle errors, and we’ve made the code more modular. 
Almost all of our work will be done in <em>src/lib.rs</em> from here on out.</p>

<p>Let’s take advantage of this newfound modularity by doing something that would have been difficult with the old code but is easy with the new code: we’ll write some tests!</p>

<h2 id="developing-the-librarys-functionality-with-test-driven-development">Developing the Library’s Functionality with Test-Driven Development</h2>

<p>Now that we’ve extracted the logic into <em>src/lib.rs</em> and left the argument collecting and error handling in <em>src/main.rs</em>, it’s much easier to write tests for the core functionality of our code. 
We can call functions directly with various arguments and check return values without having to call our binary from the command line. 
Feel free to write some tests for the functionality in the <code class="language-plaintext highlighter-rouge">Config::new</code> and <code class="language-plaintext highlighter-rouge">run</code> functions on your own.</p>

<p>In this section, we’ll add the searching logic to the <code class="language-plaintext highlighter-rouge">minigrep</code> program by using the Test-driven development (TDD) process. This software development technique follows these steps:</p>

<ol>
  <li>Write a test that fails and run it to make sure it fails for the reason you expect.</li>
  <li>Write or modify just enough code to make the new test pass.</li>
  <li>Refactor the code you just added or changed and make sure the tests continue to pass.</li>
  <li>Repeat from step 1!</li>
</ol>

<p>This process is just one of many ways to write software, but TDD can help drive code design as well. 
Writing the test before you write the code that makes the test pass helps to maintain high test coverage throughout the process.</p>

<p>We’ll test drive the implementation of the functionality that will actually do the searching for the query string in the file contents and produce a list of lines that match the query. 
We’ll add this functionality in a function called <code class="language-plaintext highlighter-rouge">search</code>.</p>

<h3 id="writing-a-failing-test">Writing a Failing Test</h3>
<p>Because we don’t need them anymore, let’s remove the <code class="language-plaintext highlighter-rouge">println!</code> statements from <em>src/lib.rs</em> and <em>src/main.rs</em> that we used to check the program’s behavior. 
Then, in <em>src/lib.rs</em>, we’ll add a tests module with a test function, as we did in Chapter 11. 
The test function specifies the behavior we want the <code class="language-plaintext highlighter-rouge">search</code> function to have: it will take a query and the text to search for the query in, and it will return only the lines from the text that contain the query. Listing 12-15 shows this test, which won’t compile yet.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>

<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">one_result</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"duct"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="s">"</span><span class="err">\</span><span class="s">
Rust:
safe, fast, productive.
Pick three."</span><span class="p">;</span>

        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="nd">vec!</span><span class="p">[</span><span class="s">"safe, fast, productive."</span><span class="p">],</span>
            <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-15-creating-a-failing-test-for-the-search-function-we-wish-we-had">Listing 12-15: Creating a failing test for the search function we wish we had</h4>

<p>This test searches for the string <code class="language-plaintext highlighter-rouge">"duct"</code>. The text we’re searching is three lines, only one of which contains <code class="language-plaintext highlighter-rouge">"duct"</code>. 
We assert that the value returned from the <code class="language-plaintext highlighter-rouge">search</code> function contains only the line we expect.</p>

<p>We aren’t able to run this test and watch it fail because the test doesn’t even compile: the <code class="language-plaintext highlighter-rouge">search</code> function doesn’t exist yet! 
So now we’ll add just enough code to get the test to compile and run by adding a definition of the <code class="language-plaintext highlighter-rouge">search</code> function that always returns an empty vector, as shown in Listing 12-16. 
Then the test should compile and fail because an empty vector doesn’t match a vector containing the line <code class="language-plaintext highlighter-rouge">"safe, fast, productive.</code>”</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">search</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nd">vec!</span><span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-16-defining-just-enough-of-the-search-function-so-our-test-will-compile">Listing 12-16: Defining just enough of the search function so our test will compile</h4>

<p>Notice that we need an explicit lifetime <code class="language-plaintext highlighter-rouge">'a</code> defined in the signature of <code class="language-plaintext highlighter-rouge">search</code> and used with the <code class="language-plaintext highlighter-rouge">contents</code> argument and the return value. 
Recall in Chapter 10 that the lifetime parameters specify which argument lifetime is connected to the lifetime of the return value. 
In this case, we indicate that the returned vector should contain string slices that reference slices of the argument <code class="language-plaintext highlighter-rouge">contents</code> (rather than the argument <code class="language-plaintext highlighter-rouge">query</code>).</p>

<p>In other words, we tell Rust that the data returned by the <code class="language-plaintext highlighter-rouge">search</code> function will live as long as the data passed into the <code class="language-plaintext highlighter-rouge">search</code> function in the <code class="language-plaintext highlighter-rouge">contents</code> argument. 
This is important! The data referenced <em>by</em> a slice needs to be valid for the reference to be valid; if the compiler assumes we’re making string slices of <code class="language-plaintext highlighter-rouge">query</code> rather than <code class="language-plaintext highlighter-rouge">contents</code>, it will do its safety checking incorrectly.</p>

<p>If we forget the lifetime annotations and try to compile this function, we’ll get this error:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">error</span><span class="p">[</span><span class="n">E0106</span><span class="p">]:</span> <span class="n">missing</span> <span class="n">lifetime</span> <span class="n">specifier</span>
 <span class="o">-</span><span class="k">-&gt;</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">51</span>
  <span class="p">|</span>
<span class="mi">5</span> <span class="p">|</span> <span class="k">pub</span> <span class="k">fn</span> <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">|</span>                                                   <span class="o">^</span> <span class="n">expected</span> <span class="n">lifetime</span>
<span class="n">parameter</span>
  <span class="p">|</span>
  <span class="o">=</span> <span class="n">help</span><span class="p">:</span> <span class="n">this</span> <span class="n">function</span><span class="nv">'s</span> <span class="k">return</span> <span class="k">type</span> <span class="n">contains</span> <span class="n">a</span> <span class="n">borrowed</span> <span class="n">value</span><span class="p">,</span> <span class="n">but</span> <span class="n">the</span>
  <span class="n">signature</span> <span class="n">does</span> <span class="n">not</span> <span class="n">say</span> <span class="n">whether</span> <span class="n">it</span> <span class="n">is</span> <span class="n">borrowed</span> <span class="n">from</span> <span class="err">`</span><span class="n">query</span><span class="err">`</span> <span class="n">or</span> <span class="err">`</span><span class="n">contents</span><span class="err">`</span>
</code></pre></div></div>

<p>Rust can’t possibly know which of the two arguments we need, so we need to tell it. 
Because <code class="language-plaintext highlighter-rouge">contents</code> is the argument that contains all of our text and we want to return the parts of that text that match, we know <code class="language-plaintext highlighter-rouge">contents</code> is the argument that should be connected to the return value using the lifetime syntax.</p>

<p>Other programming languages don’t require you to connect arguments to return values in the signature. 
Although this might seem strange, it will get easier over time. 
You might want to compare this example with the “Validating References with Lifetimes” section in Chapter 10.</p>

<p>Now let’s run the test:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
<span class="o">--</span><span class="n">warnings</span><span class="o">--</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.43</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">minigrep</span><span class="o">-</span><span class="n">abcabcabc</span>

<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">one_result</span> <span class="o">...</span> <span class="n">FAILED</span>

<span class="n">failures</span><span class="p">:</span>

<span class="o">----</span> <span class="nn">tests</span><span class="p">::</span><span class="n">one_result</span> <span class="n">stdout</span> <span class="o">----</span>
        <span class="n">thread</span> <span class="nv">'tests</span><span class="p">::</span><span class="n">one_result</span><span class="err">'</span> <span class="n">panicked</span> <span class="n">at</span> <span class="nv">'assertion</span> <span class="n">failed</span><span class="p">:</span> <span class="err">`</span><span class="p">(</span><span class="n">left</span> <span class="o">==</span>
<span class="n">right</span><span class="p">)</span><span class="err">`</span>
<span class="n">left</span><span class="p">:</span> <span class="err">`</span><span class="p">[</span><span class="s">"safe, fast, productive."</span><span class="p">]</span><span class="err">`</span><span class="p">,</span>
<span class="n">right</span><span class="p">:</span> <span class="err">`</span><span class="p">[]</span><span class="err">`</span><span class="p">)</span><span class="err">'</span><span class="p">,</span> <span class="n">src</span><span class="o">/</span><span class="n">lib</span><span class="py">.rs</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">8</span>
<span class="n">note</span><span class="p">:</span> <span class="n">Run</span> <span class="n">with</span> <span class="err">`</span><span class="n">RUST_BACKTRACE</span><span class="o">=</span><span class="mi">1</span><span class="err">`</span> <span class="k">for</span> <span class="n">a</span> <span class="n">backtrace</span><span class="py">.


failures</span><span class="p">:</span>
    <span class="nn">tests</span><span class="p">::</span><span class="n">one_result</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">FAILED</span><span class="na">. 0</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">1</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>

<span class="n">error</span><span class="p">:</span> <span class="n">test</span> <span class="n">failed</span><span class="p">,</span> <span class="n">to</span> <span class="n">rerun</span> <span class="n">pass</span> <span class="err">'</span><span class="o">--</span><span class="n">lib</span><span class="err">'</span>
</code></pre></div></div>
<p>Great, the test fails, exactly as we expected. Let’s get the test to pass!</p>

<h3 id="writing-code-to-pass-the-test">Writing Code to Pass the Test</h3>
<p>Currently, our test is failing because we always return an empty vector. 
To fix that and implement search, our program needs to follow these steps:</p>

<ul>
  <li>Iterate through each line of the contents.</li>
  <li>Check whether the line contains our query string.</li>
  <li>If it does, add it to the list of values we’re returning.</li>
  <li>If it doesn’t, do nothing.</li>
  <li>Return the list of results that match.</li>
</ul>

<p>Let’s work through each step, starting with iterating through lines.</p>

<h3 id="iterating-through-lines-with-the-lines-method">Iterating Through Lines with the lines Method</h3>
<p>Rust has a helpful method to handle line-by-line iteration of strings, conveniently named lines, that works as shown in Listing 12-17. Note this won’t compile yet.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="n">search</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">contents</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// do something with line</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-17-iterating-through-each-line-in-contents">Listing 12-17: Iterating through each line in contents</h4>

<p>The <code class="language-plaintext highlighter-rouge">lines</code> method returns an iterator. 
We’ll talk about iterators in depth in Chapter 13, but recall that you saw this way of using an iterator in Listing 3-5, where we used a <code class="language-plaintext highlighter-rouge">for</code> loop with an iterator to run some code on each item in a collection.</p>

<h3 id="searching-each-line-for-the-query">Searching Each Line for the Query</h3>
<p>Next, we’ll check whether the current line contains our query string. 
Fortunately, strings have a helpful method named <code class="language-plaintext highlighter-rouge">contains</code> that does this for us! 
Add a call to the <code class="language-plaintext highlighter-rouge">contains</code> method in the search function, as shown in Listing 12-18. 
Note this still won’t compile yet.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">search</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">contents</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">line</span><span class="nf">.contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// do something with line</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-18-adding-functionality-to-see-whether-the-line-contains-the-string-in-query">Listing 12-18: Adding functionality to see whether the line contains the string in query</h4>

<h3 id="storing-matching-lines">Storing Matching Lines</h3>
<p>We also need a way to store the lines that contain our query string. 
For that, we can make a mutable vector before the <code class="language-plaintext highlighter-rouge">for</code> loop and call the <code class="language-plaintext highlighter-rouge">push</code> method to store a line in the vector. 
After the for loop, we return the vector, as shown in Listing 12-19.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">search</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">results</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">contents</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">line</span><span class="nf">.contains</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">results</span><span class="nf">.push</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">results</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-19-storing-the-lines-that-match-so-we-can-return-them">Listing 12-19: Storing the lines that match so we can return them</h4>

<p>Now the <code class="language-plaintext highlighter-rouge">search</code> function should return only the lines that contain <code class="language-plaintext highlighter-rouge">query</code>, and our test should pass. 
Let’s run the test:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">test</span>
<span class="o">--</span><span class="n">snip</span><span class="o">--</span>
<span class="n">running</span> <span class="mi">1</span> <span class="n">test</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">one_result</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 1</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>
<p>Our test passed, so we know it works!</p>

<p>At this point, we could consider opportunities for refactoring the implementation of the search function while keeping the tests passing to maintain the same functionality. 
The code in the search function isn’t too bad, but it doesn’t take advantage of some useful features of iterators. 
We’ll return to this example in Chapter 13, where we’ll explore iterators in detail, and look at how to improve it.</p>

<h3 id="using-the-search-function-in-the-run-function">Using the search Function in the run Function</h3>
<p>Now that the <code class="language-plaintext highlighter-rouge">search</code> function is working and tested, we need to call <code class="language-plaintext highlighter-rouge">search</code> from our <code class="language-plaintext highlighter-rouge">run</code> function. 
We need to pass the <code class="language-plaintext highlighter-rouge">config.query</code> value and the <code class="language-plaintext highlighter-rouge">contents</code> that <code class="language-plaintext highlighter-rouge">run</code> reads from the file to the <code class="language-plaintext highlighter-rouge">search</code> function. Then run will print each line returned from search:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">config</span><span class="py">.filename</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="nf">search</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="py">.query</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">contents</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>
<p>We’re still using a <code class="language-plaintext highlighter-rouge">for</code> loop to return each line from <code class="language-plaintext highlighter-rouge">search</code> and print it.</p>

<p>Now the entire program should work! Let’s try it out, first with a word that should return exactly one line from the Emily Dickinson poem, “frog”:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">frog</span> <span class="n">poem</span><span class="py">.txt</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.38</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">frog</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">How</span> <span class="n">public</span><span class="p">,</span> <span class="n">like</span> <span class="n">a</span> <span class="n">frog</span>
</code></pre></div></div>

<p>Cool! Now let’s try a word that will match multiple lines, like “body”:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">body</span> <span class="n">poem</span><span class="py">.txt</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">body</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">I</span><span class="err">’</span><span class="n">m</span> <span class="nd">nobody!</span> <span class="n">Who</span> <span class="n">are</span> <span class="n">you</span><span class="o">?</span>
<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
</code></pre></div></div>

<p>And finally, let’s make sure that we don’t get any lines when we search for a word that isn’t anywhere in the poem, such as “monomorphization”:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">monomorphization</span> <span class="n">poem</span><span class="py">.txt</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">monomorphization</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
</code></pre></div></div>
<p>Excellent! We’ve built our own mini version of a classic tool and learned a lot about how to structure applications. 
We’ve also learned a bit about file input and output, lifetimes, testing, and command line parsing.</p>

<p>To round out this project, we’ll briefly demonstrate how to work with environment variables and how to print to standard error, both of which are useful when you’re writing command line programs.</p>

<h2 id="working-with-environment-variables">Working with Environment Variables</h2>

<p>We’ll improve <code class="language-plaintext highlighter-rouge">minigrep</code> by adding an extra feature: an option for case-insensitive searching that the user can turn on via an environment variable. 
We could make this feature a command line option and require that users enter it each time they want it to apply, but instead we’ll use an environment variable. 
Doing so allows our users to set the environment variable once and have all their searches be case insensitive in that terminal session.</p>

<h3 id="writing-a-failing-test-for-the-case-insensitive-search-function">Writing a Failing Test for the Case-Insensitive search Function</h3>
<p>We want to add a new <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function that we’ll call when the environment variable is on. 
We’ll continue to follow the TDD process, so the first step is again to write a failing test. 
We’ll add a new test for the new <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function and rename our old test from <code class="language-plaintext highlighter-rouge">one_result</code> to <code class="language-plaintext highlighter-rouge">case_sensitive</code> to clarify the differences between the two tests, as shown in Listing 12-20.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">case_sensitive</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"duct"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="s">"</span><span class="err">\</span><span class="s">
Rust:
safe, fast, productive.
Pick three.
Duct tape."</span><span class="p">;</span>

        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="nd">vec!</span><span class="p">[</span><span class="s">"safe, fast, productive."</span><span class="p">],</span>
            <span class="nf">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">fn</span> <span class="nf">case_insensitive</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"rUsT"</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="s">"</span><span class="err">\</span><span class="s">
Rust:
safe, fast, productive.
Pick three.
Trust me."</span><span class="p">;</span>

        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="nd">vec!</span><span class="p">[</span><span class="s">"Rust:"</span><span class="p">,</span> <span class="s">"Trust me."</span><span class="p">],</span>
            <span class="nf">search_case_insensitive</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">contents</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-20-adding-a-new-failing-test-for-the-case-insensitive-function-were-about-to-add">Listing 12-20: Adding a new failing test for the case-insensitive function we’re about to add</h4>

<p>Note that we’ve edited the old test’s <code class="language-plaintext highlighter-rouge">contents</code> too. 
We’ve added a new line with the text <code class="language-plaintext highlighter-rouge">"Duct tape."</code> using a capital D that shouldn’t match the query <code class="language-plaintext highlighter-rouge">"duct"</code> when we’re searching in a case-sensitive manner. 
Changing the old test in this way helps ensure that we don’t accidentally break the case-sensitive search functionality that we’ve already implemented. 
This test should pass now and should continue to pass as we work on the case-insensitive search.</p>

<p>The new test for the <code class="language-plaintext highlighter-rouge">case-insensitive</code> search uses <code class="language-plaintext highlighter-rouge">"rUsT"</code> as its query. 
In the <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function we’re about to add, the query <code class="language-plaintext highlighter-rouge">"rUsT"</code> should match the line containing <code class="language-plaintext highlighter-rouge">"Rust:"</code> with a capital R and match the line <code class="language-plaintext highlighter-rouge">"Trust me."</code> 
even though both have different casing from the query. 
This is our failing test, and it will fail to compile because we haven’t yet defined the <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function. 
Feel free to add a skeleton implementation that always returns an empty vector, similar to the way we did for the search function in Listing 12-16 to see the test compile and fail.</p>

<h3 id="implementing-the-search_case_insensitive-function">Implementing the search_case_insensitive Function</h3>

<p>The <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function, shown in Listing 12-21, will be almost the same as the <code class="language-plaintext highlighter-rouge">search</code> function. 
The only difference is that we’ll lowercase the <code class="language-plaintext highlighter-rouge">query</code> and each <code class="language-plaintext highlighter-rouge">line</code> so whatever the case of the input arguments, they’ll be the same case when we check whether the line contains the query.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">search_case_insensitive</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="nf">.to_lowercase</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">results</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">contents</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">line</span><span class="nf">.to_lowercase</span><span class="p">()</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">results</span><span class="nf">.push</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">results</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-21-defining-the-search_case_insensitive-function-to-lowercase-the-query-and-the-line-before-comparing-them">Listing 12-21: Defining the search_case_insensitive function to lowercase the query and the line before comparing them</h4>

<p>First, we lowercase the <code class="language-plaintext highlighter-rouge">query</code> string and store it in a shadowed variable with the same name. 
Calling <code class="language-plaintext highlighter-rouge">to_lowercase</code> on the query is necessary so no matter whether the user’s query is <code class="language-plaintext highlighter-rouge">"rust"</code>, <code class="language-plaintext highlighter-rouge">"RUST"</code>, <code class="language-plaintext highlighter-rouge">"Rust"</code>, or <code class="language-plaintext highlighter-rouge">"rUsT"</code>, we’ll treat the query as if it were <code class="language-plaintext highlighter-rouge">"rust"</code> and be insensitive to the case.</p>

<p>Note that <code class="language-plaintext highlighter-rouge">query</code> is now a <code class="language-plaintext highlighter-rouge">String</code> rather than a string slice, because calling <code class="language-plaintext highlighter-rouge">to_lowercase</code> creates new data rather than referencing existing data. 
Say the query is <code class="language-plaintext highlighter-rouge">"rUsT"</code>, as an example: that string slice doesn’t contain a lowercase <code class="language-plaintext highlighter-rouge">u</code> or <code class="language-plaintext highlighter-rouge">t</code> for us to use, so we have to allocate a new <code class="language-plaintext highlighter-rouge">String</code> containing <code class="language-plaintext highlighter-rouge">"rust"</code>. 
When we pass <code class="language-plaintext highlighter-rouge">query</code> as an argument to the <code class="language-plaintext highlighter-rouge">contains</code> method now, we need to add an ampersand(&amp;) because the signature of contains is defined to take a string slice.</p>

<p>Next, we add a call to <code class="language-plaintext highlighter-rouge">to_lowercase</code> on each <code class="language-plaintext highlighter-rouge">line</code> before we check whether it contains <code class="language-plaintext highlighter-rouge">query</code> to lowercase all characters. 
Now that we’ve converted <code class="language-plaintext highlighter-rouge">line</code> and <code class="language-plaintext highlighter-rouge">query</code> to lowercase, we’ll find matches no matter what the case of the query is.</p>

<p>Let’s see if this implementation passes the tests:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">running</span> <span class="mi">2</span> <span class="n">tests</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">case_insensitive</span> <span class="o">...</span> <span class="n">ok</span>
<span class="n">test</span> <span class="nn">tests</span><span class="p">::</span><span class="n">case_sensitive</span> <span class="o">...</span> <span class="n">ok</span>

<span class="n">test</span> <span class="n">result</span><span class="p">:</span> <span class="n">ok</span><span class="na">. 2</span> <span class="n">passed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">failed</span><span class="p">;</span> <span class="mi">0</span> <span class="n">ignored</span><span class="p">;</span> <span class="mi">0</span> <span class="n">measured</span><span class="p">;</span> <span class="mi">0</span> <span class="n">filtered</span> <span class="n">out</span>
</code></pre></div></div>

<p>Great! They passed. Now, let’s call the new <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function from the <code class="language-plaintext highlighter-rouge">run</code> function. 
First, we’ll add a configuration option to the <code class="language-plaintext highlighter-rouge">Config</code> struct to switch between case-sensitive and case-insensitive search. Adding this field will cause compiler errors because we aren’t initializing this field anywhere yet:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">query</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Note that we added the <code class="language-plaintext highlighter-rouge">case_sensitive</code> field that holds a Boolean. 
Next, we need the <code class="language-plaintext highlighter-rouge">run</code> function to check the <code class="language-plaintext highlighter-rouge">case_sensitive</code> field’s value and use that to decide whether to call the <code class="language-plaintext highlighter-rouge">search</code> function or the <code class="language-plaintext highlighter-rouge">search_case_insensitive</code> function, as shown in Listing 12-22. Note this still won’t compile yet.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span> <span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">contents</span> <span class="o">=</span> <span class="nn">fs</span><span class="p">::</span><span class="nf">read_to_string</span><span class="p">(</span><span class="n">config</span><span class="py">.filename</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">results</span> <span class="o">=</span> <span class="k">if</span> <span class="n">config</span><span class="py">.case_sensitive</span> <span class="p">{</span>
        <span class="nf">search</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="py">.query</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">contents</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">search_case_insensitive</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="py">.query</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">contents</span><span class="p">)</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">results</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="listing-12-22-calling-either-search-or-search_case_insensitive-based-on-the-value-in-configcase_sensitive">Listing 12-22: Calling either search or search_case_insensitive based on the value in config.case_sensitive</h4>

<p>Finally, we need to check for the environment variable. 
The functions for working with environment variables are in the <code class="language-plaintext highlighter-rouge">env</code> module in the standard library, so we want to bring that module into scope with a <code class="language-plaintext highlighter-rouge">use std::env;</code> line at the top of <em>src/lib.rs</em>. 
Then we’ll use the <code class="language-plaintext highlighter-rouge">var</code> function from the <code class="language-plaintext highlighter-rouge">env</code> module to check for an environment variable named <code class="language-plaintext highlighter-rouge">CASE_INSENSITIVE</code>, as shown in Listing 12-23.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/lib.rs</span>

<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="n">env</span><span class="p">;</span>

<span class="c1">// --snip--</span>

<span class="k">impl</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">String</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Config</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">args</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"not enough arguments"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">query</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="nf">.clone</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">case_sensitive</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">var</span><span class="p">(</span><span class="s">"CASE_INSENSITIVE"</span><span class="p">)</span><span class="nf">.is_err</span><span class="p">();</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">Config</span> <span class="p">{</span> <span class="n">query</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">case_sensitive</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="listing-12-23-checking-for-an-environment-variable-named-case_insensitive">Listing 12-23: Checking for an environment variable named CASE_INSENSITIVE</h4>

<p>Here, we create a new variable <code class="language-plaintext highlighter-rouge">case_sensitive</code>. 
To set its value, we call the <code class="language-plaintext highlighter-rouge">env::var</code> function and pass it the name of the <code class="language-plaintext highlighter-rouge">CASE_INSENSITIVE</code> environment variable. 
The <code class="language-plaintext highlighter-rouge">env::var</code> function returns a <code class="language-plaintext highlighter-rouge">Result</code> that will be the successful <code class="language-plaintext highlighter-rouge">Ok</code> variant that contains the value of the environment variable if the environment variable is set. 
It will return the <code class="language-plaintext highlighter-rouge">Err</code> variant if the environment variable is not set.</p>

<p>We’re using the <code class="language-plaintext highlighter-rouge">is_err</code> method on the <code class="language-plaintext highlighter-rouge">Result</code> to check whether it’s an error and therefore unset, which means it <em>should</em> do a case-sensitive search. 
If the <code class="language-plaintext highlighter-rouge">CASE_INSENSITIVE</code> environment variable is set to anything, <code class="language-plaintext highlighter-rouge">is_err</code> will return false and the program will perform a case-insensitive search. 
We don’t care about the <em>value</em> of the environment variable, just whether it’s set or unset, so we’re checking <code class="language-plaintext highlighter-rouge">is_err</code> rather than using <code class="language-plaintext highlighter-rouge">unwrap</code>, <code class="language-plaintext highlighter-rouge">expect</code>, or any of the other methods we’ve seen on <code class="language-plaintext highlighter-rouge">Result</code>.</p>

<p>We pass the value in the <code class="language-plaintext highlighter-rouge">case_sensitive</code> variable to the <code class="language-plaintext highlighter-rouge">Config</code> instance so the <code class="language-plaintext highlighter-rouge">run</code> function can read that value and decide whether to call <code class="language-plaintext highlighter-rouge">search</code> or <code class="language-plaintext highlighter-rouge">search_case_insensitive</code>, as we implemented in Listing 12-22.</p>

<p>Let’s give it a try! First, we’ll run our program without the environment variable set and with the query <code class="language-plaintext highlighter-rouge">to</code>, which should match any line that contains the word “to” in all lowercase:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span>
   <span class="n">Compiling</span> <span class="n">minigrep</span> <span class="n">v0</span><span class="na">.1.0</span> <span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="cd">///projects/minigrep)</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
</code></pre></div></div>

<p>Looks like that still works! Now, let’s run the program with <code class="language-plaintext highlighter-rouge">CASE_INSENSITIVE</code> set to <code class="language-plaintext highlighter-rouge">1</code> but with the same query to.</p>

<p>If you’re using PowerShell, you will need to set the environment variable and run the program in two commands rather than one:</p>
<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="err">$</span><span class="n">env</span><span class="p">:</span><span class="n">CASE_INSENSITIVE</span><span class="o">=</span><span class="mi">1</span>
<span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span>
</code></pre></div></div>

<p>We should get lines that contain “to” that might have uppercase letters:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">CASE_INSENSITIVE</span><span class="o">=</span><span class="mi">1</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span>
    <span class="n">Finished</span> <span class="n">dev</span> <span class="p">[</span><span class="n">unoptimized</span> <span class="o">+</span> <span class="n">debuginfo</span><span class="p">]</span> <span class="nf">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="mf">0.0</span> <span class="n">secs</span>
     <span class="n">Running</span> <span class="err">`</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">minigrep</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span><span class="err">`</span>
<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
<span class="n">To</span> <span class="n">tell</span> <span class="n">your</span> <span class="n">name</span> <span class="n">the</span> <span class="n">livelong</span> <span class="n">day</span>
<span class="n">To</span> <span class="n">an</span> <span class="n">admiring</span> <span class="nd">bog!</span>
</code></pre></div></div>

<p>Excellent, we also got lines containing “To”! Our <code class="language-plaintext highlighter-rouge">minigrep</code> program can now do case-insensitive searching controlled by an environment variable. 
Now you know how to manage options set using either command line arguments or environment variables.</p>

<p>Some programs allow arguments <em>and</em> environment variables for the same configuration. 
In those cases, the programs decide that one or the other takes precedence. 
For another exercise on your own, try controlling case insensitivity through either a command line argument or an environment variable. 
Decide whether the command line argument or the environment variable should take precedence if the program is run with one set to case sensitive and one set to case insensitive.</p>

<p>The <code class="language-plaintext highlighter-rouge">std::env</code> module contains many more useful features for dealing with environment variables: check out its documentation to see what is available.</p>

<h2 id="writing-error-messages-to-standard-error-instead-of-standard-output">Writing Error Messages to Standard Error Instead of Standard Output</h2>
<p>At the moment, we’re writing all of our output to the terminal using the <code class="language-plaintext highlighter-rouge">println!</code> function. 
Most terminals provide two kinds of output: <strong>standard output</strong> (<code class="language-plaintext highlighter-rouge">stdout</code>) for general information and <strong>standard error</strong> (<code class="language-plaintext highlighter-rouge">stderr</code>) for error messages. 
This distinction enables users to choose to direct the successful output of a program to a file but still print error messages to the screen.</p>

<p>The <code class="language-plaintext highlighter-rouge">println!</code> function is only capable of printing to standard output, so we have to use something else to print to standard error.</p>

<h3 id="checking-where-errors-are-written">Checking Where Errors Are Written</h3>
<p>First, let’s observe how the content printed by <code class="language-plaintext highlighter-rouge">minigrep</code> is currently being written to standard output, including any error messages we want to write to standard error instead. 
We’ll do that by redirecting the standard output stream to a file while also intentionally causing an error. 
We won’t redirect the standard error stream, so any content sent to standard error will continue to display on the screen.</p>

<p>Command line programs are expected to send error messages to the standard error stream so we can still see error messages on the screen even if we redirect the standard output stream to a file. 
Our program is not currently well-behaved: we’re about to see that it saves the error message output to a file instead!</p>

<p>The way to demonstrate this behavior is by running the program with &gt; and the filename, output.txt, that we want to redirect the standard output stream to. We won’t pass any arguments, which should cause an error:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="o">&gt;</span> <span class="n">output</span><span class="py">.txt</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">&gt;</code> syntax tells the shell to write the contents of standard output to <em>output.txt</em> instead of the screen. 
We didn’t see the error message we were expecting printed to the screen, so that means it must have ended up in the file. This is what output.txt contains:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Problem</span> <span class="n">parsing</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">not</span> <span class="n">enough</span> <span class="n">arguments</span>
</code></pre></div></div>
<p>Yup, our error message is being printed to standard output. 
It’s much more useful for error messages like this to be printed to standard error so only data from a successful run ends up in the file. We’ll change that.</p>

<h3 id="printing-errors-to-standard-error">Printing Errors to Standard Error</h3>
<p>We’ll use the code in Listing 12-24 to change how error messages are printed. 
Because of the refactoring we did earlier in this chapter, all the code that prints error messages is in one function, <code class="language-plaintext highlighter-rouge">main</code>. 
The standard library provides the <code class="language-plaintext highlighter-rouge">eprintln!</code> macro that prints to the standard error stream, so let’s change the two places we were calling <code class="language-plaintext highlighter-rouge">println!</code> to print errors to use <code class="language-plaintext highlighter-rouge">eprintln!</code> instead.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: src/main.rs</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">args</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">config</span> <span class="o">=</span> <span class="nn">Config</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">)</span><span class="nf">.unwrap_or_else</span><span class="p">(|</span><span class="n">err</span><span class="p">|</span> <span class="p">{</span>
        <span class="nd">eprintln!</span><span class="p">(</span><span class="s">"Problem parsing arguments: {}"</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
        <span class="nn">process</span><span class="p">::</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="nn">minigrep</span><span class="p">::</span><span class="nf">run</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">eprintln!</span><span class="p">(</span><span class="s">"Application error: {}"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>

        <span class="nn">process</span><span class="p">::</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="listing-12-24-writing-error-messages-to-standard-error-instead-of-standard-output-using-eprintln">Listing 12-24: Writing error messages to standard error instead of standard output using eprintln!</h4>

<p>After changing <code class="language-plaintext highlighter-rouge">println!</code> to <code class="language-plaintext highlighter-rouge">eprintln!</code>, let’s run the program again in the same way, without any arguments and redirecting standard output with <code class="language-plaintext highlighter-rouge">&gt;</code>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="o">&gt;</span> <span class="n">output</span><span class="py">.txt</span>
<span class="n">Problem</span> <span class="n">parsing</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">not</span> <span class="n">enough</span> <span class="n">arguments</span>
</code></pre></div></div>
<p>Now we see the error onscreen and <em>output.txt</em> contains nothing, which is the behavior we expect of command line programs.</p>

<p>Let’s run the program again with arguments that don’t cause an error but still redirect standard output to a file, like so:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">cargo</span> <span class="n">run</span> <span class="n">to</span> <span class="n">poem</span><span class="py">.txt</span> <span class="o">&gt;</span> <span class="n">output</span><span class="py">.txt</span>
</code></pre></div></div>
<p>We won’t see any output to the terminal, and output.txt will contain our results:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Filename: output.txt</span>

<span class="n">Are</span> <span class="n">you</span> <span class="n">nobody</span><span class="p">,</span> <span class="n">too</span><span class="o">?</span>
<span class="n">How</span> <span class="n">dreary</span> <span class="n">to</span> <span class="n">be</span> <span class="nd">somebody!</span>
</code></pre></div></div>
<p>This demonstrates that we’re now using standard output for successful output and standard error for error output as 
appropriate.</p>

<h2 id="summary">Summary</h2>
<p>This chapter recapped some of the major concepts you’ve learned so far and covered how to perform common I/O operations in Rust. 
By using command line arguments, files, environment variables, and the <code class="language-plaintext highlighter-rouge">eprintln!</code> macro for printing errors, you’re now prepared to write command line applications. 
By using the concepts in previous chapters, your code will be well organized, store data effectively in the appropriate data structures, handle errors nicely, and be well tested.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#practice" class="page__taxonomy-item" rel="tag">Practice</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#project" class="page__taxonomy-item" rel="tag">Project</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#summury" class="page__taxonomy-item" rel="tag">Summury</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#rust-language" class="page__taxonomy-item" rel="tag">RUST Language</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-02T00:00:00+00:00">April 2, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=RUST+%3A+12.+An+I%2FO+Project%3A+Building+a+Command+Line+Program%20https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F12.An-IO-Project-Building-a-Command-Line-Program" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F12.An-IO-Project-Building-a-Command-Line-Program" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fjjungs-lee.github.io%2F%2Frust%2F12.An-IO-Project-Building-a-Command-Line-Program" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/rust/11.Writing-Automated-Tests" class="pagination--pager" title="RUST : 11. Writing Automated Tests
">Previous</a>
    
    
      <a href="/rust/13.Functional-Language-Features_Iterators-and-Closures" class="pagination--pager" title="RUST : 13. Functional Language Features: Iterators and Closures
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/1.Hello-World" rel="permalink">Rust by Example : 1. Hello World
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  13 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">This is the source code of the traditional Hello World program.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/rust/0.Rust-By-Exaple" rel="permalink">Rust by Example : 0. Introduction
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">If you’re studying rust, it’s very helpful to follow the examples. I’m going to try to study it. :)
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/vs%20code/VSCODE-Dev-set(Settings-Sync)/" rel="permalink">Dev Setting - Settings Sync
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">I have a trouble cuz the development settings at home and at work are different.
It’s so inconvenient. So I’m trying to use syncing up settings(vscode plugin...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/github%20pages/Github-actions/" rel="permalink">Github Actions: Setting for CI server
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">In the past, When distributing the homepage was using CI called travis.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/jjungs-lee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    <li><a href="NONE"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 JJungs-lee. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
